"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[6951],{1196:(e,i,t)=>{t.d(i,{I:()=>f});var r=t(16318),n=t(93960),s=t(57537),a=t(14413),c=t(74865),o=t(20514),l=t(82786),d=t(74549),u=t(97143);function y(e,i,t){const{startTimeMs:r,words:n}=e,s=t[i+1];return{start:r||0,end:s&&s.startTimeMs?s.startTimeMs:1/0,text:n}}function v(e){return d.Q.fromInt(e).toCSS(u.a.RGB)}var p=t(74891),m=t(34645);const h={hasLyrics:!1},f=(e,i)=>{const t=(0,p.h)(i||void 0,{desiredLabel:"large",desiredSize:600})??i?.[0]?.url??"",d=(0,c.X)(),u=(0,n.NC)(m.Tc,{loadingValue:m.LZ.CONTROL}),f={[m.LZ.CONTROL]:void 0,[m.LZ.SYSTEM_LANGUAGE]:navigator.language,[m.LZ.ALL_LANGUAGES]:"all"}[u],L=["lyrics",{uri:e,image:t,vocalRemoval:d}],{hasLyrics:g,isLoading:b}=(0,a.f)(e),{data:S,isLoading:w,isError:k}=(0,r.I)({queryKey:L,queryFn:async()=>{if(!e||!t)return h;const i=await async function(e,i,t=!1,r){try{const a=await(0,o.S)(e,i,t,r);return{hasLyrics:!0,isTimeSynced:(s=a.lyrics.syncType,"LINE_SYNCED"===s||"SYLLABLE_SYNCED"===s),syncType:a.lyrics.syncType,lyrics:a.lyrics.lines.map(y),colors:(n=a.colors,{text:v(n.text),activeText:v(n.highlightText),background:v(n.background)}),provider:a.lyrics.provider,providerDisplayName:a.lyrics.providerDisplayName,providerLyricsId:a.lyrics.providerLyricsId,hasVocalRemoval:a.hasVocalRemoval??!1,showUpsell:a.lyrics.showUpsell??!1,alternatives:a.lyrics.alternatives}}catch(e){if(e instanceof l.O&&404===e.status)return{hasLyrics:!1};throw e}var n,s}(e,t,d,f);return i},gcTime:s.k,staleTime:s.H,enabled:g}),x=b||w;let I=null;return x||(I=g?S??null:h),{data:I,loading:x,error:k}}},8742:(e,i,t)=>{t.d(i,{g:()=>n});var r=t(30758);function n(){const[e,i]=(0,r.useState)(document.visibilityState);return(0,r.useEffect)((()=>{const e=()=>i(document.visibilityState);return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}),[]),e}},14413:(e,i,t)=>{t.d(i,{f:()=>d});var r=t(16318),n=t(83441),s=t(93960),a=t(31014),c=t(57537),o=t(20514),l=t(17145);const d=e=>{const i=!!e&&(0,a.U_m)(e),t=(0,s.NC)(l.s6w)&&i,{data:d,isLoading:u}=(0,r.I)({queryKey:["useLyricsAvailability",e],queryFn:async()=>!!e&&await(0,o.z)(e),gcTime:c.k,staleTime:c.H,enabled:t,placeholderData:n.rX});return{isLoading:u,hasLyrics:!!t&&(d??!1)}}},15113:(e,i,t)=>{t.d(i,{J:()=>s});var r=t(1196),n=t(92505);const s=()=>{const e=(0,n.o)((e=>e?.item),((e,i)=>e?.uri===i?.uri));return(0,r.I)(e?.uri,e?.images)}},15793:(e,i,t)=>{t.d(i,{x:()=>C});var r=t(30758),n=t(62411),s=t(77812),a=t(79252),c=t(97500),o=t.n(c),l=t(75773);const d="lyrics-lyricsContent-lyric",u="lyrics-lyricsContent-active",y="lyrics-lyricsContent-highlight",v="lyrics-lyricsContent-unsynced",p="lyrics-lyricsContent-isInteractive",m="lyrics-lyricsContent-text",h="Zg6tXwNaAAopLykLK7Cw",f="lyrics-lyricsContent-provider";var L=t(86070);const g=r.memo((function({onObserve:e,text:i,lineNumber:t,activeLineIndex:n,isTimeSynced:s,translationText:a,onClick:c,onActiveLineChange:f,windowIsVisible:g}){const{ref:b,inView:S}=(0,l.Wx)({threshold:0}),w=(0,r.useRef)(!1);(0,r.useEffect)((()=>{w.current||S&&g&&(e(i),w.current=!0)}),[S,e,i,g]);const k=(0,r.useRef)(),x=(0,r.useRef)(!0);(0,r.useEffect)((()=>{f(k,x.current),x.current=!1}),[n,f]);const I=(0,r.useCallback)((e=>{b(e),k.current=e||void 0}),[b]);return(0,L.jsxs)("div",{dir:"auto",className:o()(d,{[p]:!!c,[u]:n===t,[y]:n>t,[v]:!s}),"data-testid":"fullscreen-lyric",ref:I,onClick:c,children:[(0,L.jsx)("div",{className:m,children:i}),a&&(0,L.jsx)("div",{className:h,children:a})]})}));var b=t(62935);const S={start:0,end:1,text:""};var w=t(20932),k=t(45127),x=t(92505);var I=t(49662),T=t(8742);const C=r.memo((function({trackUri:e,data:i,format:t,onLineClick:c,onActiveLineChange:o,isSnippet:l}){const{provider:d,providerLyricsId:u,providerDisplayName:y,syncType:v,isTimeSynced:p}=i,m=(0,n.d4)(I.s),{lyricWithEmptyLines:h,activeLineIndex:C,hasSkipped:E,shouldAnimateScroll:N}=((e,i,t)=>{const n=(0,r.useRef)(0),{lyrics:s=[],isTimeSynced:a,alternatives:c}=i,o=(0,r.useRef)(0),[l]=(0,b.f)(500,(i=>i?.item?.uri===e)),d=t?c?.find((({language:e})=>e.substring(0,2)===t.substring(0,2)))?.lines:null,u=(0,r.useMemo)((()=>[...new Array(2).fill(S),...s].map(((e,i)=>({...e,lineNumber:i,translationText:d?.[i-2]})))),[s,d]),y=a?u.findIndex((({start:e,end:i})=>l>=e&&l<i)):-1,v=o.current;o.current=y;const p=Math.abs(y-v)<=4,m=Math.abs(l-n.current)>2e3;return n.current=l,{lyricWithEmptyLines:u,activeLineIndex:y,prevActiveLineIndex:v,lineIndexDiff:y-v,shouldAnimateScroll:p,hasSkipped:m}})(e,i,m),A=function(e){const{trackUri:i,format:t,provider:n,providerLyricsId:s,syncType:a,isSnippet:c}=e,[o,l]=(0,r.useState)(!1),[d,u]=(0,r.useState)(0),[y,v]=(0,r.useState)(!1),p=(0,x.o)((e=>e?.playbackId??void 0)),m=(0,r.useMemo)((()=>(0,w.W)({lyrics_format:t,track_uri:i,provider:n,provider_lyrics_id:s,sync_type:a,playback_id:p,is_snippet:c})),[t,i,n,s,a,p,c]);(0,r.useEffect)((()=>{l(!1),u(0),v(!1);const e=setTimeout((()=>{v(!0)}),1500);return()=>{clearTimeout(e)}}),[m]);const h=(0,k.vh)();return(0,r.useEffect)((()=>{o||d>=140&&y&&(h.send(m),l(!0))}),[d,o,m,h,y]),(0,r.useCallback)((e=>{e.length>1&&u((i=>i+e.length))}),[u])}({trackUri:e,format:t,provider:d,providerLyricsId:u,syncType:v,isSnippet:l}),R=(0,T.g)();return(0,L.jsxs)(L.Fragment,{children:[h.map((({text:e,lineNumber:i,translationText:t})=>(0,L.jsx)(g,{text:e,translationText:t,lineNumber:i,activeLineIndex:C,isTimeSynced:p,onObserve:A,onClick:c&&(e=>c(e,h[i].start)),onActiveLineChange:(e,t)=>o({lineRef:e,firstUpdate:t,isFirstLine:p&&0===i,isActiveLine:p&&C===i,activeLineIndex:C,hasSkipped:E,shouldAnimateScroll:N}),windowIsVisible:"visible"===R},i))),!l&&y&&(0,L.jsx)("div",{className:f,children:(0,L.jsx)(s.E,{as:"p",variant:"bodySmall",dir:"auto",children:a.Ru.get("web-player.lyrics.providedBy",y)})})]})}))},20514:(e,i,t)=>{t.d(i,{S:()=>a,z:()=>c});var r=t(31014),n=t(68265),s=t(81907);const a=async(e,i,t,a)=>{const c=(0,r.o_h)(e).id,o=n.n.getInstance(),l={format:"json",vocalRemoval:t};a&&(l.clientLanguage=a);return(await o.build().withHost(s.Hj).withPath(`/track/${encodeURIComponent(c)}/image/${encodeURIComponent(i)}`).withQueryParameters(l).withEndpointIdentifier("/track/{trackId}").send()).body},c=async e=>{const i=(0,r.Y8v)((0,r.o_h)(e)?.id);if(!i)return!1;const t=n.n.getInstance(),a=await t.build().withHost(s.XE).withPath(`/track/${encodeURIComponent(i)}`).withEndpointIdentifier("/track/{trackId}").send();return a.body?.has_lyrics||!1}},30911:(e,i,t)=>{t.d(i,{H:()=>a});var r=t(48526),n=t(92505),s=t(74891);function a(){const e=(0,n.o)((e=>e?.item),((e,i)=>e?.uri===i?.uri)),i=(0,s.h)(e?.images||void 0,{desiredLabel:"large",desiredSize:600})??e?.images?.[0]?.url??"",{data:t}=(0,r.g)([i]);return t??null}},49662:(e,i,t)=>{t.d(i,{s:()=>n,u:()=>r});const r=e=>e.ui.lyrics.mode,n=e=>e.ui.lyrics.translationLanguage},57537:(e,i,t)=>{t.d(i,{H:()=>n,k:()=>r});const r=18e5,n=6e5},74865:(e,i,t)=>{t.d(i,{X:()=>a});var r=t(93960),n=t(17145),s=t(8477);const a=()=>{const e=(0,s.S)(),{isSupported:i}=e.getCapabilities();return(0,r.NC)(n.OBX,{loadingValue:!1})&&i}}}]);
//# sourceMappingURL=6951.js.map