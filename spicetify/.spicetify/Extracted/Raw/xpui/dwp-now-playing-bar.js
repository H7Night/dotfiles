"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[3322],{422:(e,t,n)=>{n.d(t,{f:()=>m});var i=n(30758),s=n(97500),a=n.n(s),o=n(46462),r=n(58325);const c="main-genericButton-button",l="main-genericButton-buttonActive",u="main-genericButton-buttonActiveDot";var d=n(86070);const m=(0,i.forwardRef)(((e,t)=>{const n=e.isActive??!1,i=a()(c,{[l]:n||e.isActiveNoIndicator,[u]:n},e.className);return(0,d.jsx)(r.Zp,{label:e.label,children:(0,d.jsx)(o.H,{ref:t,style:e.style,"aria-label":e.label,size:"small",className:i,disabled:e.disabled,iconOnly:e.icon,onClick:e.onToggle,"data-testid":e.testId,"data-active":n.toString(),"aria-pressed":n,"data-restore-focus-key":e.restoreFocusKey})})}))},2117:(e,t,n)=>{n.d(t,{NowPlayingBar:()=>Ls});var i=n(30758),s=n(97500),a=n.n(s),o=n(62411),r=n(94079),c=n(24299),l=n(25270),u=n(57221),d=n(17640);const m="dz_h98rH9nZCwfPdnKgr",g="rAfV2jB_HMM9Xtr0Rqvn",p="XkXPpDRWozMF6G8_GlLQ";var v=n(86070);const y=i.memo((function(e){const{handleClick:t}=e,n=d.Ru.get("pta.bottom-bar.title"),i=d.Ru.get("fta.bottom-bar.subtitle"),s=d.Ru.get("fta.sign-up-free");return(0,v.jsxs)("div",{className:m,onClick:t,"data-testid":"signup-bar",children:[(0,v.jsxs)("div",{className:g,children:[(0,v.jsx)(l.E,{as:"p",variant:"bodySmallBold",children:n}),(0,v.jsx)(l.E,{as:"p",variant:"bodyMedium",dangerouslySetInnerHTML:{__html:i}})]}),(0,v.jsx)(u.$,{colorSet:"invertedLight",onClick:t,className:p,children:s})]})}));var b=n(78631),h=n(7362),x=n(42343),k=n(58652),C=n(39715),N=n(99659),f=n(59242),I=n(5141);const j="gqYYMz8DkhaT3e44LcHQ",S="VX33mI2V_jRA7hRBI9_0",A=({remoteDeviceName:e,remoteDeviceType:t,connectionStatus:n,omitConnectionStateText:i=!1})=>{const{spec:s,logger:a}=(0,I.r)(x.s,{}),{triggerRef:o,toggleDevicePicker:r,isPickerOpen:c}=(0,C.z)(),u=(0,N.$A)(t,n),m=n===f.zP.CONNECTED?d.Ru.get("web-player.connect.bar.connected-state",{device_name:e}):d.Ru.get("web-player.connect.bar.connecting-state",{device_name:e});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u,{size:"small",className:S,role:"presentation",semanticColor:"essentialBase"}),(0,v.jsx)(h.Y,{component:"button",onClick:()=>{const e=s.activeDeviceButtonFactory(),{interactionId:t}=a.logInteraction(c?e.hitUiHide():e.hitUiReveal()),n=c;r(t),n||(0,k.I)("DEVICE-PICKER")},ref:o,className:j,children:(0,v.jsx)(l.E,{variant:"bodySmallBold","aria-live":"polite",semanticColor:"textBase",children:i&&n===f.zP.CONNECTED?e:m})})]})},w="nQSM_BrSHJ4Cp3XSuLOF",T=()=>(0,v.jsxs)("svg",{width:"1",height:"16",viewBox:"0 0 1 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",role:"separator",className:w,children:[(0,v.jsx)("g",{id:"separator",clipPath:"url(#clip0_491_88335)",children:(0,v.jsx)("rect",{id:"Rectangle 111112858",width:"1",height:"16",rx:"0.5",fill:"var(--essential-base)"})}),(0,v.jsx)("defs",{children:(0,v.jsx)("clipPath",{id:"clip0_491_88335",children:(0,v.jsx)("rect",{width:"1",height:"16",fill:"white"})})})]});var P=n(83656),E=n(52253),L=n(9981),D=n(42005),B=n(12434);const R="main-connectBar-connectBar",_="main-connectBar-connected",O="main-connectBar-connecting",U=function(){const{isPlayingRemotely:e,connectionStatus:t,remoteDeviceName:n,remoteDeviceType:i}=(0,L.v)((e=>{const t=(0,E.V)(e);return{isPlayingRemotely:t.isPlayingRemotely,connectionStatus:t.connectionStatus,remoteDeviceName:t.remoteDevice?.name,remoteDeviceType:t.remoteDevice?.type}}),B.a),{currentSession:s}=(0,D.D)(),o=Boolean(s?.active),r=e&&n&&i;if(!r&&!o)return null;const c=t===f.zP.CONNECTED||o,l=t===f.zP.CONNECTING&&!o;return(0,v.jsxs)("div",{className:a()(R,{"encore-bright-accent-set":c,[_]:c,[O]:l}),children:[o&&(0,v.jsx)(P.K,{}),o&&r&&(0,v.jsx)(T,{}),r&&(0,v.jsx)(A,{connectionStatus:t,remoteDeviceName:n,remoteDeviceType:i,omitConnectionStateText:o})]})},F=()=>(0,v.jsx)(i.Suspense,{fallback:null,children:(0,v.jsx)(U,{})});var M=n(40638),z=n(75044),V=n(52223),G=n(91292),H=n(96381),Q=n(95083),q=n(32712),K=n(422),Y=n(13637),Z=n(11957);const W=({className:e="",disabledClassName:t="",onClick:n})=>{const s=(0,q.lZ)(),r=(0,i.useContext)(Q.s),c=(0,Z.o)((e=>e?.hasContext??!1)),l=(0,o.wA)(),u=!c,m=(0,i.useCallback)((async()=>{r?.current&&(n?.(!0),l((0,H.f)()),(0,Y.X8)(r.current))}),[l,r,n]),g=a()(e,{[t]:u});return s?(0,v.jsx)(K.f,{onToggle:m,className:g,icon:G.L,label:d.Ru.get("npv.full-screen"),disabled:u,testId:"fullscreen-mode-button"}):null},X=(0,i.memo)(W);var J=n(86925),$=n(73001),ee=n(31077);var te=n(5844),ne=n(46462),ie=n(76151);const se="xP7v0EBcbJMj1xIJxywg",ae="zJU_lLLzQL6oKvMA0c5b",oe=({onClose:e,onMouseEnter:t,onMouseLeave:n,onClick:i,impressionCallback:s,message:a})=>(0,v.jsxs)("div",{className:se,onMouseEnter:t,onMouseLeave:n,ref:s,onClick:i,children:[(0,v.jsx)(l.E,{id:"nudgeBody",as:"p",variant:"bodyMedium",semanticColor:"textBase",children:a}),(0,v.jsx)(ne.H,{iconOnly:ie.M,size:"small",semanticColor:"textBase",onClick:t=>{t.stopPropagation(),e?.()},"aria-label":d.Ru.get("close"),className:ae})]});var re=n(64360),ce=n(86339);const le=(e=re.C)=>{const t=(0,o.Pj)(),{isActive:n}=e(),i=(0,ce.h)();return document.hasFocus()&&!n&&!(({ui:e,ads:t},n)=>e.blockUserDialog.isOpen||e.connectDevicePicker.isOpen||e.deleteFolderDialog.isOpen||e.deletePlaylistDialog.isOpen||e.fullscreenMode.isOpen||e.improvedSignupPromptDialog.isOpen||e.keyboardShortcutsHelpModal.isOpen||e.leavePlaylistDialog.isOpen||e.offlineDeviceLimitReachedDialog.isOpen||e.playbackNotSupportedErrorDialog.isOpen||e.premiumDialog.isOpen||!0===t.billboard?.isOpen&&!t.billboard.isMinimized||!1===t.vto?.isHidden&&!1===t.vto?.isMinimized||n)(t.getState(),i.current.length>0)};var ue=n(16619);var de=n(65080),me=n(80385),ge=n(9430),pe=n(72240),ve=n(36838),ye=n(1678),be=n(69795),he=n(29645);const xe=e=>{const t=(0,i.useRef)(),n=(0,i.useRef)(),s=(0,i.useRef)(!1),a=(0,ve.z)(),o=(0,me.Z)(),{spec:r,logger:c}=(0,I.r)(ue.w,{}),l=(0,i.useRef)(null),u=(0,i.useCallback)((()=>{c.logInteraction(r.djVoiceUnsupportedNudgeFactory().closeButtonFactory().hitUiHide())}),[r,c]),m=(0,i.useCallback)((e=>{e&&l.current!==e&&c.logImpression(r.djVoiceUnsupportedNudgeFactory().impression()),l.current=e}),[r,c]),g=(0,i.useCallback)((()=>{const e=a.getState(),t=o.getActiveDevice();return!(e=>e?.isLocal??!1)(t)&&(0,he.yc)(e,"spotify:playlist:37i9dQZF1EYkqdzj48dyYq")!==be.i.NOT_ACTIVE&&!(e=>Boolean(e?.supportsDJNarration))(t??void 0)}),[a,o]),p=(0,i.useCallback)((()=>{g()&&e({nudgeType:"message-only-nudge",message:d.Ru.get("web-player.connect.nudge.dj-voice-unavailable"),onClose:u,impressionCallback:m})}),[e,g,u,m]),v=(0,i.useCallback)((e=>{e.data.action===pe.Ik.PLAY&&(s.current=!0)}),[]);(0,ye.p)(pe.gd.ACTION,v);const y=(0,i.useCallback)((e=>{s.current&&(0,he.uW)(e.data)===be.i.PLAYING&&(t.current=e.data?.context.uri,p(),t.current=void 0,s.current=!1)}),[p]);(0,ye.p)(pe.gd.UPDATE,y);const b=(0,i.useCallback)((e=>{const t=e.data?.activeDevice;t&&!t.isLocal&&n.current!==t.connectStateId&&p(),n.current=t?.connectStateId}),[p]);(0,ge.W)(de.P.UPDATE,b)};var ke=n(43955);const Ce=e=>{switch(e.type){case f.bq.AUDIO_DONGLE:case f.bq.AVR:case f.bq.CAST_AUDIO:case f.bq.CAST_VIDEO:case f.bq.GAME_CONSOLE:case f.bq.SPEAKER:case f.bq.STB:case f.bq.TV:return!0;default:return!1}};var Ne=n(91302),fe=n(10432),Ie=n(99565);const je=new Date(0).toISOString(),Se=["shift+alt+f10"],Ae=e=>{const t=(0,i.useRef)(),n=(0,i.useRef)(!1),s=(0,i.useRef)(!1),a=(0,o.Pj)(),r=(0,ve.z)(),c=(0,me.Z)(),l=(0,fe.V)(),[u,m]=(0,Ie.x)("connect-nudge-triggered-at",je),g=(0,i.useRef)(null),{spec:p,logger:v}=(0,I.r)(ue.w,{}),y=(0,i.useCallback)((()=>{v.logInteraction(p.connectFromDevicePickerNudgeFactory().hitNoAction())}),[p,v]),b=(0,i.useCallback)((()=>{v.logInteraction(p.connectFromDevicePickerNudgeFactory().closeButtonFactory().hitUiHide())}),[p,v]),h=(0,i.useCallback)((e=>{e&&g.current!==e&&v.logImpression(p.connectFromDevicePickerNudgeFactory().impression()),g.current=e}),[p,v]);(0,Ne.f)(Se,(async()=>{const{platform:{isDeveloperMode:e}}=a.getState();if(e){const e=new Date;e.setHours(e.getHours()-8),m(e.toISOString())}}));const x=(0,i.useCallback)((()=>{const e=r.getState(),t=c.getActiveDevice(),n=c.getDevices(),i=l.getDefaultDevice(),s=new Date(u);s.setHours(s.getHours()+8);return s<=new Date&&(e=>e?.isLocal??!1)(t)&&!(0,he.A3)(e)&&(e=>e.some((e=>e.isLocalNetwork&&!e.isDisabled&&Ce(e))))(n)&&(e=>!e||!(e.terminalType===ke.FI.HEADPHONES||e.terminalType===ke.FI.SPEAKERS&&(e.transportType===ke.Yg.BLUETOOTH||e.transportType===ke.Yg.USB)))(i)}),[r,l,u,c]),k=(0,i.useCallback)((()=>{if(x()){e({nudgeType:"message-only-nudge",message:d.Ru.get("web-player.connect.nudge.listen-to-speaker"),impressionCallback:h,onClick:y,onClose:b});const t=(new Date).toISOString();m(t)}}),[e,x,m,y,b,h]),C=(0,i.useCallback)((e=>{e.data.action===pe.Ik.PLAY?n.current=!0:e.data.action===pe.Ik.RESUME&&(s.current=!0)}),[]);(0,ye.p)(pe.gd.ACTION,C);const N=(0,i.useCallback)((e=>{n.current&&(0,he.uW)(e.data)===be.i.PLAYING?(t.current=e.data?.context.uri,k(),t.current=void 0,n.current=!1):s.current&&!1===e.data?.isPaused&&(t.current=e.data?.context.uri,k(),t.current=void 0,s.current=!1)}),[k]);(0,ye.p)(pe.gd.UPDATE,N)};var we=n(37947),Te=n(12599),Pe=n(67843),Ee=n(5849),Le=n(43122),De=n(91773),Be=n(17354),Re=n(78570),_e=n(70002);const Oe=e=>{const t=(0,De.d)(),{getSessionInfo:n,joinSession:s,currentSession:a}=(0,D.D)(),o=(0,Pe.vh)(),r=(0,Ee.b)(),c=(0,ke.lS)(r),l=(0,i.useRef)(new Set),u=(0,i.useCallback)((async(e,t,n)=>{l.current.add(t);const i="IN_PERSON",a=Re.JO.NEARBY_DIALOG;try{const r=await s(e,a,i);r&&o.send((0,we.X)({session_id:t,join_type:a,join_url:r.joinSessionUri,participation_mode:i,discovery_methods:[n]}))}catch(e){e instanceof Error&&o.send((0,we.X)({session_id:t,error_category:e.name,error_data:e.message,discovery_methods:[n]}))}}),[o,s]),m=(0,ve.z)(),g=(0,i.useCallback)((()=>(0,he.uW)(m.getState())!==be.i.PLAYING),[m]),p=(0,i.useCallback)((async(t,{sessionMembers:n,sessionOwnerId:i,sessionId:s,isSessionOwner:a})=>{const o=n.find((e=>e.id===i));if(!o||a)return;const r=n.map((e=>({uri:(0,Te.Qjr)(e.username).toURI(),displayName:e.displayName,username:e.username,images:e.imageUrl?[{url:e.imageUrl}]:[]})));if(g()){const n=t.tech===_e.x.BLUETOOTH?"bluetooth":"broadcast";e({nudgeType:"join-listening-session-nudge",title:d.Ru.get("web-player.social-connect.broadcasting.join-listening-session-nudge-title",{host:o.displayName,device:t.title}),message:d.Ru.get("web-player.social-connect.broadcasting.join-listening-session-nudge-text"),onClose:()=>{},onActionButtonClick:()=>{u(t.token,s,n)},users:r,discoveryMethod:n})}}),[g,u,e]);(0,Be.c)(Le.P.SCAN_UPDATE,(()=>{if(a?.active)return;const e=t.getLocalNetSessionDevices(),i=e?.devices.find((e=>e.isNew));i&&(async e=>{if(c)return;const i=await n(e.token);if(i){if(l.current.has(i.sessionId))return;const n=await t.getLocalNetSesssionDeviceVisibility(i.sessionId);n!==Re.MS.UNSPECIFIED&&n!==Re.MS.NOTIFY||p(e,i)}})(i)}))};var Ue=n(37953),Fe=n(84104),Me=n(46628),ze=n(99993);const Ve=e=>{Ae(e),xe(e),Oe(e),(e=>{const{panelSend:t}=(0,Ue.AI)(Me.Z.DevicePicker,Me.Z.DevicePickerOverlay),[n,s]=(0,Ie.x)("session-broadcast-nudge-shown",[]),a=(0,i.useCallback)((e=>{const t=[...n,e];t.length>10&&t.shift(),s(t)}),[n,s]);(0,Be.c)(Le.P.BROADCAST_NUDGE,(({data:i})=>{const s=i.deviceId;i.broadcastStatus===ze.ez.BROADCAST_ON&&s&&!n.includes(s)&&e({nudgeType:"session-is-being-broadcasted-nudge",message:d.Ru.get("web-player.social-connect.broadcasting.session-is-being-broadcasted-nudge-text"),onClose:()=>{},onActionButtonClick:()=>{t({type:Fe.$S.DEVICE_PICKER_BUTTON_CLICK})},onShow:()=>{a(s)}})}))})(e)},Ge=()=>{const e=(0,i.useRef)(),t=(0,i.useRef)(!1),n=(0,i.useRef)(!1),s=(0,o.wA)(),a=(0,o.d4)((e=>e.ui.connectNudge.isOpen)),r=(0,o.d4)((e=>e.ui.connectDevicePicker.isOpen)),c=(0,i.useCallback)((()=>{n.current&&(clearTimeout(e.current),n.current=!1),s((0,H.Yp)())}),[s]),l=(0,i.useCallback)((()=>{n.current=!1,t.current||c()}),[c]),u=(0,i.useCallback)((()=>{e.current=window.setTimeout(l,8e3),s((0,H.dK)()),n.current=!0}),[s,l]),d=(0,i.useCallback)((e=>{t.current=e,e||n.current||c()}),[c]);return(0,i.useEffect)((()=>{r&&c()}),[r,c]),(0,i.useMemo)((()=>({hideNudge:c,showNudge:u,setShouldKeepShowingNudge:d,isNudgeVisible:a})),[c,u,d,a])};var He=n(48664),Qe=n(32959);const qe="uETBcNmdHUHF_YPLJfOx",Ke="kb2DrVIixaicEzk6sEcP",Ye="PmEpl43j3MvwvoqnnZ6A",Ze="zWPenObFu5ZjWvtk_qSb",We=({onClose:e,onActionButtonClick:t,onMouseEnter:n,onMouseLeave:s,message:a,title:o,users:r,discoveryMethod:c})=>{const{spec:m,logger:g}=(0,I.r)(He.m,{}),p=(0,i.useMemo)((()=>m.nudgeScanningTooltipFactory({reason:c})),[c,m]);(0,i.useEffect)((()=>{g.logImpression(p.impression())}),[g,p]);const y=(0,i.useCallback)((()=>{g.logInteraction(p.closeButtonFactory().hitUiHide()),e?.()}),[g,p,e]),b=(0,i.useCallback)((()=>{g.logInteraction(p.joinButtonFactory().hitJoinSocialListeningSession()),t()}),[g,t,p]);return(0,v.jsxs)("div",{className:qe,onMouseEnter:n,onMouseLeave:s,children:[(0,v.jsxs)("div",{className:Ke,children:[r.length>0&&(0,v.jsx)(Qe.g,{users:r}),(0,v.jsx)(l.E,{as:"p",variant:"bodyMediumBold",semanticColor:"textBase",className:Ye,children:o}),(0,v.jsx)(ne.H,{iconOnly:ie.M,size:"small",semanticColor:"textBase",onClick:y,"aria-label":d.Ru.get("close")})]}),(0,v.jsx)(l.E,{id:"nudgeBody",as:"p",variant:"bodySmall",semanticColor:"textBase",children:a}),(0,v.jsx)("div",{className:Ze,children:(0,v.jsx)(u.$,{colorSet:"invertedLight",size:"small",onClick:b,children:d.Ru.get("web-player.social-connect.join-modal.button-primary")})})]})};var Xe=n(81680);const Je="_eXNo3nLWPbXuTHH7K08",$e="VT_giL9ITyvqFuzZsmWk",et="m5mgkcoKawOAJIWj0JE7",tt=({onActionButtonClick:e,onMouseEnter:t,onMouseLeave:n,message:s,onShow:a})=>{const{spec:o,logger:r}=(0,I.r)(He.m,{});(0,i.useEffect)((()=>{a?.(),r.logImpression(o.nudgeBroadcastingTooltipFactory().impression())}),[r,a,o]);const c=(0,i.useCallback)((()=>{r.logInteraction(o.nudgeBroadcastingTooltipFactory().changeButtonFactory().hitUiReveal()),e?.()}),[r,e,o]);return(0,v.jsxs)("div",{className:Je,onMouseEnter:t,onMouseLeave:n,children:[(0,v.jsx)(Xe.h,{size:"medium",className:$e}),(0,v.jsx)(l.E,{id:"nudgeBody",as:"p",variant:"bodySmall",semanticColor:"textBase",children:s}),(0,v.jsx)("div",{className:et,children:(0,v.jsx)(u.$,{colorSet:"invertedLight",size:"small",onClick:c,children:d.Ru.get("web-player.social-connect.broadcasting.session-is-being-broadcasted-nudge-button")})})]})},nt=({children:e,useNudgeTriggers:t=Ve,useToggleNudgeWithTimer:n=Ge,useCanShowNudge:s=le,disabled:a=!1})=>{const{showNudge:o,hideNudge:r,setShouldKeepShowingNudge:c,isNudgeVisible:l}=n(),[u,d]=(0,i.useState)(null),m=s();(0,i.useEffect)((()=>{l&&!m&&r()}),[m,r,l]),t((e=>!(l||!m)&&(d(e),o(),!0)));const g=(0,i.useCallback)((e=>{if(!e)return(0,v.jsx)(v.Fragment,{});const t=()=>{e?.onClose?.(),r()};if("join-listening-session-nudge"===e.nudgeType){const n=()=>{e.onActionButtonClick?.(),r()};return(0,v.jsx)(We,{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),...e,onClose:t,onActionButtonClick:n})}if("session-is-being-broadcasted-nudge"===e.nudgeType){const n=()=>{e.onShow?.()};return(0,v.jsx)(tt,{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),...e,onClose:t,onShow:n})}return(0,v.jsx)(oe,{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),...e,onClose:t})}),[r,c]);return(0,v.jsx)(te.W,{maxWidth:"join-listening-session-nudge"===u?.nudgeType?450:void 0,placement:"top",visible:Boolean(u?.message)&&l&&!a,overlay:g(u),popperOptions:{modifiers:[{name:"preventOverflow",options:{rootBoundary:"viewport",altAxis:!0,padding:24,tether:!1}}]},onHide:()=>{},fadeOut:!0,useLazyMounting:!0,children:e})};var it=n(43601);const st=()=>{const{remoteDeviceType:e,remoteDeviceIsGroup:t,connectionStatus:n}=(0,L.v)((e=>{const t=(0,E.V)(e);return{remoteDeviceType:t.remoteDevice?.type,remoteDeviceIsGroup:t.remoteDevice?.isGroup,connectionStatus:t.connectionStatus}}),B.a),s=(0,$.g)(),{canTogglePanel:a,isActive:o,togglePanel:r}=(0,ee.C)(),{spec:c,logger:l}=(0,I.r)(J.p,{}),u=(0,i.useCallback)((()=>{const{interactionId:e}=l.logInteraction(function(e,t,n){return {interactionId:null,pageInstanceId:null};let i;return i=t===f.zP.CONNECTING?e.connectingButtonFactory():t===f.zP.CONNECTED?e.connectedButtonFactory():e.notConnectedButtonFactory(),n?i.hitUiHide():i.hitUiReveal()}(c,n,o));r(e)}),[n,r,o,c,l]),{currentDevice:m}=(0,it.l)(),{isLocal:g}=m,p=(0,i.useMemo)((()=>(0,N.tf)(e,t,g?s:null)),[s,g,t,e]);return(0,v.jsx)(nt,{children:(0,v.jsx)(K.f,{isActive:o,disabled:!a,onToggle:u,label:d.Ru.get("playback-control.connect-picker"),icon:p})})};var at=n(51043),ot=n(10192);var rt=n(14221);const ct=Fe.$S.PUFFIN_BUTTON_CLICK,lt=Fe.$S.DEVICE_PICKER_BUTTON_CLICK,ut=()=>{const{isPuffinPanelActive:e}=(0,rt.c)(),{isActive:t,panelSend:n}=(0,Ue.AI)(Me.Z.DevicePicker,Me.Z.DevicePickerOverlay),s=(0,Ue.Ev)(ct),{remoteDeviceType:a,remoteDeviceisGroup:o}=(0,L.v)((e=>{const t=(0,E.V)(e);return{remoteDeviceType:t.remoteDevice?.type,remoteDeviceisGroup:t.remoteDevice?.isGroup}}),B.a),r=(0,$.g)(),c=r?.audioDevice.terminalType===ke.FI.HEADPHONES,l=(()=>{const{deviceFilterState:e}=(0,ot.j)();return e.currentState.externalizationEnabled||e.currentState.specificEnabled})(),u=t||e,m=l||c,{currentDevice:g}=(0,it.l)(),{isLocal:p}=g,y=(0,i.useMemo)((()=>l?at.C:(0,N.tf)(a,o,p?r:null)),[r,l,o,a,p]);return(0,v.jsx)(K.f,{isActive:u,isActiveNoIndicator:m,onToggle:()=>{const e=t;n(lt),e||(0,k.I)("DEVICE-PICKER")},label:d.Ru.get("playback-control.connect-picker"),icon:y,disabled:!s,restoreFocusKey:e?Me.Z.Puffin:Me.Z.DevicePicker})};var dt=n(80396),mt=n(7397);const gt=()=>{const{isAnonymous:e}=(0,o.d4)(mt.Ht),t=(0,dt.v)();return e?null:t?(0,v.jsx)(i.Suspense,{fallback:null,children:(0,v.jsx)(ut,{})}):(0,v.jsx)(st,{})};var pt=n(59983),vt=n(2849),yt=n(13225),bt=n(98965),ht=n(55405);const xt=i.memo((({onClick:e,className:t,isActive:n,isEnabled:i})=>{const s=i?d.Ru.get("web-player.lyrics.title"):d.Ru.get("web-player.lyrics.noLyrics1"),a=i?e:void 0;return(0,v.jsx)(K.f,{className:t,isActive:n,onToggle:a,disabled:!i,label:s,testId:"lyrics-button",icon:pt.q})})),kt=i.memo((e=>{const t=Boolean((0,bt.J)().data?.hasLyrics);return(0,v.jsx)(xt,{...e,isEnabled:t,isActive:!1})})),Ct=i.memo((e=>{const t=(0,Z.o)((e=>e?.item?.uri)),n=Boolean((0,yt.f)(t).hasLyrics);return(0,v.jsx)(xt,{...e,isEnabled:n,isActive:!1})})),Nt=i.memo((e=>{const{isActive:t}=(0,vt.$)(),{isAnonymous:n}=(0,o.d4)(mt.Ht),i=(0,z.NC)(ht.khs),s=(0,Z.o)((e=>{if(e?.item?.uri&&(0,Te.U_m)(e?.item?.uri)){return!Boolean(e?.item?.metadata?.["segment.index"])}return!1}));return n||!s?null:t?(0,v.jsx)(xt,{...e,isActive:!0,isEnabled:!0}):i?(0,v.jsx)(kt,{...e}):(0,v.jsx)(Ct,{...e})}));var ft=n(49908);const It=({onClick:e,className:t})=>{const{toggleLyrics:n}=(0,ft.A)({onChange:e,referrer:"now_playing_bar"});return(0,v.jsx)(Nt,{onClick:n,className:t})};var jt=n(50312),St=n(27736),At=n(91780);const wt=Fe.$S.NPV_BUTTON_CLICK,Tt=({onClick:e})=>{const{isActive:t,panelSend:n}=(0,Ue.AI)(Me.Z.NowPlayingView),i=(0,Ue.Ev)(wt),{mode:s,setMode:a}=(0,St.r)(),o=(0,z.NC)(ht.ZDY),{item:r}=(0,Z.o)((e=>({item:e?.item})),((e,t)=>e.item?.uri===t.item?.uri)),c=!r||!i;return o?null:(0,v.jsx)(K.f,{isActive:t,disabled:c,onToggle:()=>{e?.(!t),n(wt),s===At.YU.cinema&&a(At.YU.npv)},icon:jt.d,label:d.Ru.get("web-player.now-playing-view.label"),testId:"control-button-npv",restoreFocusKey:Me.Z.NowPlayingView})};var Pt=n(85387),Et=n(76186),Lt=n(57211),Dt=n(69987),Bt=n(71331),Rt=n(7840),_t=n(78504),Ot=n(34306);const Ut=({uri:e,to:t,children:n,onDrop:s,onNavigate:a,className:r})=>{const[c,l]=(0,i.useState)(!1),u=(0,i.useRef)(null),d=(0,Rt.g)(),m=(0,o.wA)(),g=(0,_t.f)(),p=(0,Ot.g)(),y=(0,ve.z)(),b=function(e){const t=(0,Te.o_h)(e),n=(0,o.d4)(mt.F6);switch(t?.type){case Te.NQG.PLAYLIST:case Te.NQG.PLAYLIST_V2:{let e;if((0,Te.iwx)(t)&&(e=t.username),n&&e===n)return[Bt.Ay[Te.NQG.TRACK],Bt.Ay[Te.NQG.LOCAL],Bt.Ay[Te.NQG.ALBUM]];break}case Te.NQG.COLLECTION:return[Bt.Ay[Te.NQG.TRACK],Bt.Ay[Te.NQG.ALBUM],Bt.Ay[Te.NQG.ARTIST],Bt.Ay[Te.NQG.PLAYLIST],Bt.Ay[Te.NQG.PLAYLIST_V2],Bt.Ay[Te.NQG.SHOW]];case Te.NQG.QUEUE:return[Bt.Ay[Te.NQG.TRACK],Bt.Ay[Te.NQG.LOCAL],Bt.Ay[Te.NQG.EPISODE]];default:return[]}return[]}(e),h=!!b.length;return(0,i.useEffect)((()=>(c?u.current=window.setTimeout((()=>{(0,Te.U_m)(e)||(a?.(),d(t||(0,Te.o_h)(e).toURLPath(!0)))}),1e3):!c&&u.current&&clearTimeout(u.current),()=>{u.current&&clearTimeout(u.current)})),[c,e,t,a,d]),h?(0,v.jsx)(Dt.A,{types:b,onDrop:t=>{const n=(0,Te.o_h)(e),i=Array.from(t.dataTransfer.types).find((e=>b.includes(e))),a=i&&t.dataTransfer.getData(i),o=a&&a.split("\n")[0],r=(0,Te.o_h)(o);if(r&&n)switch(s?.(r.toURI()),n.type){case Te.NQG.PLAYLIST:case Te.NQG.PLAYLIST_V2:m((0,Lt.io)(e,[r.toURI()]));break;case Te.NQG.COLLECTION:(0,Te._Tv)(r)||(0,Te.ecE)(r)||(0,Te.U_m)(r)?g.add({uris:[r.toURI()]}):(0,Te.tbX)(r)?p.add([r.toURI()],{before:"start"}):(0,Te.WB1)(r)&&g.add({uris:[r.toURI()]});break;case Te.NQG.QUEUE:y.addToQueue([{uri:r.toURI(),uid:null}])}},onDragEnter:()=>{l(!0)},onDragLeave:()=>{l(!1)},className:r,children:n}):(0,v.jsx)("div",{children:n})};var Ft=n(12543);function Mt({style:e,active:t,disabled:n,intent:s,label:a,labelActive:o,icon:r,iconActive:c,className:l,onClick:u}){const[d,m]=(0,i.useState)(!1),g=(0,Ft.W)(),p=t&&o?o:a,y=t&&c?c:r;return(0,v.jsx)(K.f,{style:e,className:l,isActive:t,disabled:n,onToggle:e=>{u?.(),d||e.target.blur(),m(!1),s&&g({type:"click",intent:s,targetUri:""})},onKeyDown:({key:e})=>{"enter"===e.toLowerCase()&&m(!0)},label:p,icon:y,testId:`control-button-${s}`})}var zt=n(21712),Vt=n(49361),Gt=n(35397),Ht=n(46504);const Qt=()=>{const{isAnonymous:e}=(0,o.d4)(mt.Ht),{videoPlayerMode:t}=(0,Vt.d)();return e||t===Gt.Kz.cinemaLegacy?{isVisible:!1}:{isVisible:!0,isEnabled:!0}},qt=({onClick:e})=>{const{isEnabled:t,isVisible:n}=Qt(),s=(0,Pt.zy)(),a=(0,Ht.J)(),o=(0,Rt.g)(),r=(0,i.useMemo)((()=>"/queue"===s.pathname||"/history"===s.pathname),[s.pathname]),c=(0,i.useCallback)((()=>{const t=a.entries?.slice(0,a.index+1)?.reverse()?.findIndex((({pathname:e})=>"/queue"!==e&&"/history"!==e));e({mode:"main",route:null}),o(-1===t?"/":t>=0?-t:-1)}),[o,a,e]),l=(0,i.useCallback)((()=>{e({mode:"main",route:"/queue"}),o("/queue",{state:{referrer:"now_playing_bar"}})}),[e,o]),u=(0,i.useCallback)((()=>{t&&(r?c():l())}),[t,r,c,l]);return n?(0,v.jsx)(Ut,{uri:"spotify:queue",children:(0,v.jsx)(Mt,{intent:"queue",icon:Et.j,label:d.Ru.get("playback-control.queue"),onClick:u,active:r,disabled:!t})}):null},Kt=Fe.$S.QUEUE_BUTTON_CLICK,Yt=({onClick:e})=>{const{isEnabled:t,isVisible:n}=Qt(),s=(0,Ue.Ev)(Kt),{isActive:a}=(0,Ue.AI)(Me.Z.Queue,Me.Z.QueueOverlay),{toggleQueue:o}=(0,zt.R)(),r=(0,i.useCallback)((()=>{t&&(e({mode:"panel",aboutToShow:!a}),o())}),[t,e,a,o]);return n?(0,v.jsx)(Ut,{uri:"spotify:queue",children:(0,v.jsx)(K.f,{icon:Et.j,label:d.Ru.get("playback-control.queue"),onToggle:r,isActive:a,disabled:!t||!s,testId:"control-button-queue",restoreFocusKey:Me.Z.Queue})}):null},Zt=({onClick:e})=>(0,z.NC)(ht.eWj)?(0,v.jsx)(Yt,{onClick:e}):(0,v.jsx)(qt,{onClick:e});var Wt=n(12876),Xt=n(73429),Jt=n(71267);const $t=({onClick:e})=>{const{item:t}=(0,Xt.L)()??{},{isActive:n,onClick:i,showButton:s}=(0,Jt.D)({item:t,onClick:e});return t&&s?(0,v.jsx)(K.f,{isActive:n,onToggle:i,label:n?d.Ru.get("miniplayer.close"):d.Ru.get("miniplayer.open"),icon:Wt.F,testId:"pip-toggle-button"}):null};var en=n(32914),tn=n(71373);const nn="main-nowPlayingBar-extraControls",sn="main-nowPlayingBar-lyricsButton",an="main-nowPlayingBar-volumeBar",on=()=>{const e=(0,z.NC)(ht.yux),t=(0,z.NC)(ht.mzn),{setVideoPlayerUIFlag:n,videoPlayerMode:s}=(0,Vt.d)(),{spec:a,logger:o,UBIFragment:r}=(0,I.r)(V.h9,{data:{identifier:s===Gt.Kz.cinemaLegacy?V.gw.CINEMA:V.gw.DESKTOP}}),c=(0,M.YQ)((e=>{o.logInteraction(a.volumeBarFactory().dragSetVolume({newVolumePercentage:Math.floor(100*e)}))}),500,{leading:!1,trailing:!0}),l=(0,i.useCallback)((e=>{e&&n(Gt.nP.cinemaLegacy,!1)}),[n]);return(0,v.jsx)(r,{spec:a,children:(0,v.jsxs)("div",{className:nn,children:[(0,v.jsx)(tn.mA,{onClick:()=>{o.logInteraction(a.djJumpButtonFactory().hitRefreshContent())}}),(0,v.jsx)(Tt,{onClick:e=>{e?o.logInteraction(a.npvButtonFactory().hitUiReveal()):o.logInteraction(a.npvButtonFactory().hitUiHide())}}),!e&&(0,v.jsx)(It,{className:sn,onClick:e=>{e?o.logInteraction(a.lyricsButtonFactory().hitUiNavigate({destination:e})):o.logInteraction(a.lyricsButtonFactory().hitUiNavigateBack())}}),(0,v.jsx)(Zt,{onClick:e=>{"main"===e.mode?e.route?o.logInteraction(a.queueButtonFactory().hitUiNavigate({destination:e.route})):o.logInteraction(a.queueButtonFactory().hitUiNavigateBack()):e.aboutToShow?o.logInteraction(a.queueButtonFactory().hitUiReveal()):o.logInteraction(a.queueButtonFactory().hitUiHide())}}),(0,v.jsx)(gt,{}),(0,v.jsx)(en.M,{className:an,onVolumeBarClick:e=>{o.logInteraction(a.volumeBarFactory().hitSetVolume({newVolumePercentage:Math.floor(100*e)}))},onToggleMuteClick:e=>{"muted"===e?o.logInteraction(a.volumeMuteButtonFactory().hitMutePlayback()):"not_muted"===e&&o.logInteraction(a.volumeMuteButtonFactory().hitUnmutePlayback())},onVolumeBarDrag:c}),(0,v.jsx)($t,{onClick:l}),!t&&(0,v.jsx)(X,{className:"control-button",disabledClassName:"control-button--disabled",onClick:e=>{e&&o.logInteraction(a.fullscreenButtonFactory().hitUiReveal())}})]})})};var rn=n(52945),cn=n(53313),ln=n(75539);const un="yyrJTUPMeLS8qs1a0YJr",dn=({logoUrl:e})=>e?(0,v.jsx)("div",{className:un,"data-testid":"context-ad-logo",children:(0,v.jsx)(cn.N,{loading:"eager",imgSrc:e,width:56,height:56,type:ln.c.AD})}):null;var mn=n(72532),gn=n(53476),pn=n(49211);const vn=({item:e,context:t,index:n})=>{const{logoImage:i}=(0,mn.b)(e);return(0,v.jsx)(pn.e,{item:e,context:t,index:n,"aria-label":d.Ru.get("ad-formats.advertisement"),adEventReason:gn.c.AD_LOGO,isVisible:!1,children:(0,v.jsx)(dn,{logoUrl:i})})};var yn=n(79583),bn=n(71468);const hn=i.memo((function({uri:e,className:t,onClick:n,size:s=yn.t.xs}){const[a,o]=(0,bn.A)(e),r=(0,Ft.W)(),c=(0,i.useCallback)((t=>{t.preventDefault(),r({targetUri:e,intent:a?"remove-from-library":"add-to-library",type:"click"}),n&&n(!a),o(!a)}),[r,e,a,n,o]);return(0,v.jsx)(yn.M,{className:t,size:s,onClick:c,isAdded:!!a,condensed:!0})}));var xn=n(4806),kn=n(37136),Cn=n(13997);const Nn=({uri:e,isBook:t=!1,size:n=yn.t.xs,className:s,onClick:a})=>{const{isPreSaved:o,addPresave:r,removePresave:c}=(0,Cn.w)({uri:e,isBook:t}),l=(0,i.useCallback)((()=>{o?c():r(),a?.(!o)}),[o,a,c,r]);return(0,v.jsx)(yn.M,{className:s,size:n,onClick:l,isAdded:!!o,condensed:!0})};var fn=n(17188),In=n(93850),jn=n(33961),Sn=n(52492),An=n(43294),wn=n(88025),Tn=n(27733),Pn=n(18469),En=n(56673),Ln=n(35279),Dn=n(96203),Bn=n(47219),Rn=n(24821);function _n(e){return(0,Rn.v)(e)||(0,Bn.p)(e)}var On=n(61101);const Un=Fe.$S.NPV_BUTTON_CLICK,Fn=()=>{const e=(0,On.l)(),t=(0,z.NC)(ht.mzn),n=(0,z.NC)(ht.wZE),s=(0,Tn.S)(),a=(0,Ue._Y)();return(0,i.useCallback)((()=>{t?s===wn.z.CLOSED?n?e(wn.z.NOW_PLAYING_VIEW):a(Un):e(wn.z.CLOSED):a(Un)}),[n,s,t,a,e])};var Mn=n(36458),zn=n(37833),Vn=n(58089);const Gn="main-nowPlayingWidget-nowPlaying",Hn="ZbFkATBbLkWh2SHMXDt6",Qn="main-coverSlotCollapsed-navAltContainer",qn="main-nowPlayingWidget-coverArt",Kn="main-nowPlayingWidget-trackInfo",Yn="HD9s7U5E1RLSWKpXmrqx",Zn=({spec:e})=>{const t=(0,Vn.s)(),n=(0,Xt.L)(),{draggable:s,onDragStart:a}=(0,zn.P)(),o=(0,Tn.S)(),{isActive:r}=(0,Ue.AI)(Me.Z.NowPlayingView),c=(0,z.NC)(ht.mzn),l=Fn(),{images:u}=(0,Mn.u)(n?.item),m=c?o===wn.z.NOW_PLAYING_VIEW:r,g=(0,i.useCallback)((()=>{l();const n=m?e.hitUiHide():e.hitUiReveal();t.logInteraction(n)}),[m,t,e,l]);if(null===n)return null;const{context:p,item:y}=n;return(0,v.jsx)(An.h,{menu:(0,v.jsx)(En.W,{context:p,item:y}),children:(0,v.jsx)("div",{draggable:s&&_n(y),onDragStart:e=>{a(e,{itemUris:[y.uri],dragLabelText:(0,Dn.r)(y)})},children:(0,v.jsx)(Ln.R,{uri:p.uri,owner:p.metadata?.context_owner,children:(0,v.jsx)("button",{type:"button","data-testid":"cover-art-button",className:Yn,"aria-label":d.Ru.get("web-player.now-playing-view.label"),onClick:g,children:(0,v.jsx)(Pn.b,{images:u,type:y.type,size:56,maxSize:56,className:qn})})})})})};var Wn=n(26111),Xn=n(93162),Jn=n(64797),$n=n(58325);const ei="main-coverSlotCollapsed-container",ti="main-coverSlotCollapsed-expandButton",ni=Fe.$S.NPV_BUTTON_CLICK,ii=({children:e,className:t,spec:n})=>{const s=(0,Vn.s)(),o=(0,Ue.Ev)(ni),r=(0,Tn.S)(),{isActive:c}=(0,Ue.AI)(Me.Z.NowPlayingView),l=(0,z.NC)(ht.mzn),u=(0,z.NC)(ht.wZE),m=Fn(),g=(0,i.useMemo)((()=>{if(l&&u){const e=r===wn.z.NOW_PLAYING_VIEW;return{label:e?d.Ru.get("web-player.cinema-mode.minimize"):d.Ru.get("web-player.now-playing-view.cinema-mode.expand"),Icon:e?Wn.b:G.L,isActive:e,isDisabled:!1}}return{label:c?d.Ru.get("npb.collapseCoverArt"):d.Ru.get("npb.expandCoverArt"),Icon:c?Xn.r:Jn.o,isActive:c,isDisabled:!o}}),[u,o,r,l,c]),p=(0,i.useCallback)((()=>{m();const e=n.coverartArrowFactory(),t=g.isActive?e.hitUiHide():e.hitUiReveal();s.logInteraction(t)}),[s,n,g.isActive,m]);return(0,v.jsxs)("div",{"data-testid":"CoverSlotCollapsed__container",className:a()(ei,t),children:[e,(0,v.jsx)($n.Zp,{label:g.label,children:(0,v.jsx)("button",{className:a()(ti),disabled:g.isDisabled,onClick:p,"aria-label":g.label,"aria-pressed":g.isActive,children:(0,v.jsx)(g.Icon,{iconSize:16})})})]})};var si=n(30337),ai=n(82107),oi=n(72823);var ri=n(86874),ci=n(38641),li=n(25733),ui=n(31889),di=n(63715),mi=n(6725),gi=n(92375),pi=n(91563);const vi=({context:e,item:t,onLike:n})=>{const i=(0,li.X)(),s=(0,In.v)(t);if(i&&(0,ci.N)(t))return(0,v.jsx)(ri.o,{contextUri:t.metadata?.context_uri??e.uri,id:t.uid??void 0,uri:t.uri,isActive:!0});if(s)return(0,v.jsx)(fn.g,{uri:t.uri,condensed:!0});if((0,Rn.v)(t))return t.isLocal?null:(0,v.jsx)(kn.b,{uri:t.uri,className:"control-button control-button-heart",onClick:n});if((0,Bn.p)(t))return(0,v.jsx)(xn.b,{condensed:!0,uri:t.uri,className:"control-button control-button-heart",onClick:n});if((0,di.d)(t)){return"trailer"===t?.metadata?.type&&"true"===t?.metadata?.is_pre_release?(0,v.jsx)(Nn,{uri:t.book.uri,isBook:!0,className:"control-button control-button-heart",onClick:n}):(0,v.jsx)(hn,{uri:t.book.uri,className:"control-button control-button-heart",onClick:n})}return(0,ui.N)(t)||(0,mi.v)(t)?null:(0,pi.d)(t)},yi=({state:{item:e,context:t,index:n}})=>{!function(e){const t=(0,oi.i)(),n=(0,ai.X)(e);(0,i.useEffect)((()=>{n&&t.say(n)}),[n,t])}(e);const{videoPlayerMode:s,setVideoPlayerUIFlag:a}=(0,Vt.d)(),{spec:o,logger:r}=(0,I.r)(rn.p6,{data:{identifier:s===Gt.Kz.cinemaLegacy?rn.gw.CINEMA:rn.gw.DESKTOP}}),c=(0,ai.P)(e),l=(0,z.NC)(ht.WAA);(0,i.useEffect)((()=>{a(Gt.nP.nowPlayingBar,l)}),[l,a]);const u=s===Gt.Kz.nowPlayingBar&&l,d=(0,i.useMemo)((()=>o.coverartFactory({uri:e.uri})),[e.uri,o]);return(0,v.jsx)(i.Suspense,{fallback:null,children:(0,v.jsx)("div",{"data-testid":"now-playing-widget",className:Gn,role:"contentinfo","aria-label":c,children:(0,v.jsxs)(gi.r,{spec:o,children:[(0,ui.N)(e)?(0,v.jsx)(vn,{item:e,context:t,index:n}):(0,v.jsxs)(ii,{className:Qn,spec:d,children:[!u&&(0,v.jsx)(Zn,{spec:d}),l&&(0,v.jsx)("div",{id:"VideoPlayerNpb_ReactPortal"})]}),(0,v.jsx)(jn.d,{context:t,className:Kn,item:e,size:"xsmall",enableVideoButton:!0,onTitleClick:t=>{r.logInteraction(o.titleFactory({uri:e.uri}).hitUiNavigate({destination:t||""}))},onSubtitleClick:t=>{r.logInteraction(o.subtitleFactory({uri:e.uri}).hitUiNavigate({destination:t||""}))},referrer:Sn.G.NPB}),(0,v.jsxs)("div",{className:Hn,children:[(0,v.jsx)(si.a,{context:t,item:e,onClick:()=>{r.logInteraction(o.hideButtonFactory().hitRemoveRecommendation({recommendedItemUri:e.uri,contextUri:t.uri}))}}),(0,v.jsx)(vi,{item:e,onLike:t=>{r.logInteraction(t?o.likeButtonFactory({uri:e.uri}).hitLike({itemToBeLiked:e.uri}):o.likeButtonFactory({uri:e.uri}).hitRemoveLike({itemNoLongerLiked:e.uri}))},context:t})]})]})})})},bi=()=>{const e=(0,Xt.L)();return null===e?(0,v.jsx)("div",{className:a()("now-playing")}):(0,v.jsx)(yi,{state:e})};var hi=n(4598);const xi="aguQsGoZR9wZeawKGdDh",ki="ieqOSqJb6kk3bG5XDOHk",Ci=({paused:e,fromSeconds:t})=>{const[n,s]=(0,i.useState)(t);return(0,hi.$)((t=>{s((n=>e?n:n>0?n-1:(t(),n)))}),1e3),(0,v.jsxs)("div",{className:xi,children:[d.Ru.get("ad-formats.skippable_ads.skip_countdown"),(0,v.jsx)("span",{className:ki,children:n})]})};var Ni=n(70539);const fi=({children:e})=>{const t=(0,Z.o)((e=>e),((e,t)=>(0,B.a)(e?.restrictions,t?.restrictions)&&e?.item?.uri===t?.item?.uri&&e?.isPaused===t?.isPaused)),n=t?.restrictions.disallowSkippingNextReasons.includes("ad_disallow"),i=t?.isPaused??!1,s=(0,Ni.qc)(t),a=(0,Ni.Tv)(t),r=(0,o.d4)((e=>s?e?.ads?.audio?.info?.skippableAdDelaySeconds:a?e?.ads?.vto?.info?.skippableAdDelaySeconds:void 0));return n&&r?(0,v.jsx)(Ci,{paused:!!i,fromSeconds:r}):(0,v.jsx)(v.Fragment,{children:e})};var Ii=n(57146),ji=n(68624);var Si=n(9297);const Ai=e=>{const[t,n]=(0,i.useState)(new Map),[s,a]=(0,i.useState)(),o=(0,Si.L)(),r=(0,ji.mr)(),{currentDevice:c}=(0,it.l)(),l=(0,Pe.vh)(),u=(0,i.useCallback)((()=>{if(!e)return;const i=(({lastRecordedItem:e,setLastRecordedItem:t,recentAds:n,setRecentAds:i,playerStateItem:s,currentDevice:a})=>{let o={isMissingAdData:!1};if(s&&s.uri!==e?.uri){if(e?.type===ln.c.AD){const t=e?.uri.split(":")[2];n.has(t)?i((e=>{const n=new Map(e);return n.delete(t),n})):o={isMissingAdData:!0,errorMessage:a.isLocal?"primary_device":"secondary_device",adId:t}}t((()=>s))}return o})({lastRecordedItem:s,setLastRecordedItem:a,recentAds:t,setRecentAds:n,playerStateItem:o?.item,currentDevice:c});if(i.isMissingAdData){const{errorMessage:e,adId:t}=i;l.send((0,Ii.G)({error_type:"missing_ad_data",error_message:e,slot:"stream",ad_id:t}))}}),[o,s,t,l,c,e]),d=(0,i.useCallback)((()=>{e&&r&&n((e=>{let n=e;return t.has(r.adId)||(n=new Map(e).set(r.adId,r)),n}))}),[t,r,e]);(0,i.useEffect)((()=>{u()}),[u]),(0,i.useEffect)((()=>{d()}),[d])};var wi=n(74598),Ti=n(1340),Pi=n(84904),Ei=n(38511),Li=n(54355),Di=n(51029),Bi=n(80855),Ri=n(42335),_i=n(32163),Oi=n(95982);const Ui="player-controls",Fi="player-controls__buttons",Mi="player-controls__left",zi="player-controls__right",Vi=(0,i.memo)((function({item:e}){const t=Ei.Q.isPodcastAd(e),n=Ei.Q.isSurveyAd(e);return(0,v.jsxs)("div",{"data-testid":"ad-controls",className:Fi,children:[(0,v.jsxs)("div",{className:Mi,children:[t&&(0,v.jsx)(Oi.w,{}),(0,v.jsx)(Pi.T,{item:e,isDisabled:n}),t?(0,v.jsx)(Di.h,{}):(0,v.jsx)(Ri.d,{})]}),(0,v.jsx)(Li.x,{}),(0,v.jsxs)("div",{className:zi,children:[t?(0,v.jsx)(Bi.v,{}):(0,v.jsx)(fi,{children:(0,v.jsx)(_i.$,{})}),(0,v.jsx)(Ti.t,{item:e,isDisabled:n})]})]})}));var Gi=n(10734),Hi=n(90245),Qi=n(23501),qi=n(92266),Ki=n(3109),Yi=n(69796);var Zi=n(42438),Wi=n(95741),Xi=n(70816);const Ji="JbGNL7qsnWz6EP_3hGvf",$i="mkROcxw9LM6F2uuwQYjN",es=e=>{const{className:t,...n}=e;return(0,v.jsx)("span",{className:$i,children:(0,v.jsx)(Xi.x,{className:a()(t),...n})})};var ts=n(80090),ns=n(87098),is=n(31592),ss=n(31273),as=n(7613),os=n(58998),rs=n(32650);const cs=function({setSleepTimer:e,state:t}){const n=t.type===as.k.Off?ss.X:ss.X.concat(as.k.Off);return(0,v.jsxs)(ts.W,{children:[(0,v.jsx)(ns.y,{children:d.Ru.get("web-player.sleep-timer.player-controls.popover.title")}),(0,v.jsx)("div",{children:n.map((n=>(0,v.jsx)(is.D,{onClick:()=>{e(n)},"data-testid":`playback-sleep-timer-option-${n}`,role:"menuitemradio","aria-label":`${n}`,"aria-checked":t.type===n,children:t.type===n?(0,rs.J)(n,t.endsAt,ln.c.EPISODE):(0,os.p)(n,ln.c.EPISODE)},n)))})]})};var ls=n(87983);const us=e=>e-Date.now(),ds=({endsAt:e})=>{const[t,n]=(0,i.useState)(us(e));return(0,i.useEffect)((()=>{n(us(e));const t=setInterval((()=>{n(us(e))}),1e3);return()=>{clearInterval(t)}}),[e]),(0,v.jsx)(l.E,{variant:"marginal",semanticColor:"textBrightAccent",children:(0,ls.f)(t)})};var ms=n(94488);const gs=({onClick:e})=>{const t=(0,z.NC)(ht.GhO),[n,i]=(0,ms.y)(),s=n.type!==as.k.Off,{endsAt:a}=n;return t?(0,v.jsx)(Wi.t,{placement:"top-start",menu:(0,v.jsx)(cs,{state:n,setSleepTimer:t=>{i(t),e?.(t)}}),children:(e,t,n)=>(0,v.jsx)($n.Zp,{label:d.Ru.get("web-player.sleep-timer.player-controls.button.tooltip"),children:(0,v.jsx)(ne.H,{ref:n,className:Ji,iconLeading:s?es:Zi.l,size:"small",onClick:t,role:"checkbox","aria-label":d.Ru.get("web-player.sleep-timer.player-controls.button.tooltip"),"data-testid":"control-button-sleep-timer","aria-checked":s,semanticColor:s?"textBrightAccent":void 0,children:s&&a&&(0,v.jsx)(ds,{endsAt:a})})})}):null};var ps=n(5200),vs=n(96514);const ys=(0,i.memo)((function({isPreview:e}){const{logChangePlaybackSpeed:t,logChangeRepeatMode:n,logChangeShuffleMode:s,logSeekForward:a,logSeekBack:o,logSkipForward:r,logSkipBack:c,logPlayPause:l,logProgressChanged:u,spec:m}=(()=>{const e=(0,ve.z)(),{videoPlayerMode:t}=(0,Vt.d)(),{spec:n,logger:s}=(0,I.r)(qi.kD,{data:{identifier:t===Gt.Kz.cinemaLegacy?qi.gw.CINEMA:qi.gw.DESKTOP}});return{logChangePlaybackSpeed:(0,i.useCallback)((t=>{const i=e.getState();i?.item&&s.logInteraction(n.speedControlButtonFactory().hitSetPlaybackSpeed({currentlyPlayedItem:i.item.uri,playbackSpeed:t}))}),[s,e,n]),logChangeShuffleMode:(0,i.useCallback)((e=>{s.logInteraction(e?n.shuffleButtonFactory().hitShuffleEnable():n.shuffleButtonFactory().hitShuffleDisable())}),[s,n]),logChangeRepeatMode:(0,i.useCallback)((e=>{const t={[Ki.p.REPEAT_NONE]:n.repeatButtonFactory().hitRepeatDisable(),[Ki.p.REPEAT_TRACK]:n.repeatButtonFactory().hitRepeatOneEnable(),[Ki.p.REPEAT_CONTEXT]:n.repeatButtonFactory().hitRepeatEnable()};s.logInteraction(t[e])}),[s,n]),logSeekBack:(0,i.useCallback)((e=>{s.logInteraction(n.seekBackButtonFactory().hitSeekByTime({msSeekedOffset:e}))}),[s,n]),logSeekForward:(0,i.useCallback)((e=>{s.logInteraction(n.seekForwardButtonFactory().hitSeekByTime({msSeekedOffset:e}))}),[s,n]),logSkipBack:(0,i.useCallback)((()=>{const t=e.getState();t&&s.logInteraction(n.previousButtonFactory().hitSkipToPrevious({itemToBeSkipped:t.item?.uri||"",positionMs:(0,Yi.s)(t)??-1,totalContentMs:t.duration??-1}))}),[s,e,n]),logSkipForward:(0,i.useCallback)((()=>{const t=e.getState();t?.item&&s.logInteraction(n.nextButtonFactory().hitSkipToNext({itemToBeSkipped:t.item.uri,positionMs:(0,Yi.s)(t)??-1,totalContentMs:t.duration??-1}))}),[s,e,n]),logPlayPause:(0,i.useCallback)((t=>{const i=e.getState();i?.item&&("resume"===t?s.logInteraction(n?.playPauseButtonFactory().hitResume({itemToBeResumed:i.item.uri})):"pause"===t&&s.logInteraction(n?.playPauseButtonFactory().hitPause({itemToBePaused:i.item.uri})))}),[s,e,n]),logProgressChanged:(0,i.useCallback)(((e,t)=>{switch(t){case"drag":return s.logInteraction(n.progressBarFactory().dragSeekToTime({msToSeekTo:e}));case"hit":return s.logInteraction(n.progressBarFactory().hitSeekToTime({msToSeekTo:e}));default:return(0,pi.k)(t)}}),[s,n]),spec:n}})();Ai((0,z.NC)(ht.KYh));const g=(0,Z.o)((e=>e?.item??void 0),((e,t)=>e?.uri===t?.uri)),p=(0,Qi.p)();return(0,v.jsx)("div",{className:Ui,"data-testid":"player-controls",dir:"ltr","aria-label":d.Ru.get("playback-control.a11y.landmark-label"),children:(0,v.jsxs)(gi.r,{spec:m,children:[(0,ui.N)(g)?(0,v.jsx)(Vi,{item:g}):(0,v.jsxs)("div",{className:Fi,"data-testid":"general-controls",children:[(0,v.jsxs)("div",{className:Mi,children:[p?(0,v.jsx)(Oi.w,{onClick:t}):(0,v.jsx)(vs.w,{renderEnabled:()=>(0,v.jsx)(ps.a,{size:"small"}),renderDisabled:()=>(0,v.jsx)(Hi.u,{onClick:s})}),p&&(0,v.jsx)(Di.h,{onClick:o}),(0,v.jsx)(Ri.d,{onClick:c})]}),(0,v.jsx)(Li.x,{onClick:l}),(0,v.jsxs)("div",{className:zi,children:[(0,v.jsx)(fi,{children:(0,v.jsx)(_i.$,{onClick:r})}),p?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Bi.v,{onClick:a}),(0,v.jsx)(gs,{})]}):(0,v.jsx)(Gi.s,{onClick:n})]})]}),(0,v.jsx)(wi.x,{isPreview:e,onChange:u})]})})}));var bs=n(82232),hs=n(83531),xs=n(78256),ks=n(78247);const Cs="main-nowPlayingBar-container",Ns="main-nowPlayingBar-nowPlayingBar",fs="MWD1i_CSJ5N9wRBDpZmX",Is="k3NVrHXkbfflNdAxpT1_",js="m8UPWsNtWbdkvBNvqgBN",Ss="aepuRyT82biv_XmkH1eS",As="main-nowPlayingBar-left",ws="main-nowPlayingBar-center",Ts="main-nowPlayingBar-right",Ps="K7b2iysmIbvKo8RqRbc5",Es="adzMqeRxU0__wQcuju5q",Ls=(0,i.memo)((()=>{const{isAnonymous:e}=(0,o.d4)(mt.Ht),t=(0,o.wA)(),n=(0,Z.o)((e=>e),((e,t)=>e?.hasContext===t?.hasContext&&e?.item?.uri===t?.item?.uri)),s=(0,b.h)(),l=(0,Z.o)((e=>(0,ui.N)(e?.item??void 0))),u=(0,i.useCallback)((e=>{e.stopPropagation(),t((0,c.Ai)())}),[t]),d=()=>(0,v.jsx)(hs.ql.Provider,{value:"now_playing_bar",children:(0,v.jsxs)("div",{className:e?fs:Ns,children:[(0,v.jsx)("div",{className:As,children:(0,v.jsx)(bi,{})}),(0,v.jsx)("div",{className:ws,children:(0,v.jsx)(i.Suspense,{fallback:null,children:(0,v.jsx)(ys,{isPreview:e})})}),(0,v.jsx)("div",{className:Ts,children:(0,v.jsx)(on,{})})]})});return(0,v.jsx)(ks.P,{surface:xs.u.NOW_PLAYING,children:(0,v.jsx)(bs.pZ,{value:"now-playing-bar",children:(0,v.jsxs)("footer",{className:a()(Cs,Ps,{[Es]:s}),"data-testid":"now-playing-bar","data-testadtype":"ad-type-"+(l?"ad":"none"),children:[e?(0,v.jsx)(bs.pZ,{value:"preview-bar",children:(0,v.jsx)(y,{handleClick:u})}):null,e?(0,v.jsx)(r.A,{in:n?.hasContext??!1,timeout:200,classNames:{enter:Is,enterActive:js,enterDone:Ss},children:d()}):d(),(0,v.jsx)(F,{})]})})})}))},2849:(e,t,n)=>{n.d(t,{$:()=>a});var i=n(85387);const s="/lyrics",a=()=>({isActive:(0,i.zy)().pathname.startsWith(s),routeDestination:s})},13225:(e,t,n)=>{n.d(t,{f:()=>u});var i=n(16318),s=n(83441),a=n(75044),o=n(12599),r=n(62461),c=n(52630),l=n(55405);const u=e=>{const t=!!e&&(0,o.U_m)(e),n=(0,a.NC)(l.s6w)&&t,{data:u,isLoading:d}=(0,i.I)({queryKey:["useLyricsAvailability",e],queryFn:async()=>!!e&&await(0,c.z)(e),gcTime:r.k,staleTime:r.H,enabled:n,placeholderData:s.rX});return{isLoading:d,hasLyrics:!!n&&(u??!1)}}},13997:(e,t,n)=>{n.d(t,{w:()=>u});var i=n(30758),s=n(40876),a=n(17640),o=n(93301),r=n(60464),c=n(33425),l=n(5141);const u=({uri:e,isBook:t})=>{const{add:n,remove:u}=(0,c.p)("prerelease"),d=(0,r.o)("prerelease",[e]).at(0),{enqueueSnackbar:m}=(0,o.d)(),{spec:g,logger:p}=(0,l.r)(s.k,{data:{uri:e}});return{isPreSaved:d,addPresave:(0,i.useCallback)((async()=>{p.logInteraction(g.actionBarFactory().preSaveButtonFactory().hitPresave({prereleaseId:e,itemToBePresaved:e,contextUri:e})),await n(e),m(t?a.Ru.get("web-player.prerelease.audiobook_feedback_presaved"):a.Ru.get("web-player.prerelease.album_feedback_presaved"))}),[n,m,t,p,g,e]),removePresave:(0,i.useCallback)((async()=>{p.logInteraction(g.actionBarFactory().preSaveButtonFactory().hitRemovePresave({prereleaseId:e,itemToBeRemovedFromPresaved:e,contextUri:e})),await u(e)}),[p,u,g,e])}}},23501:(e,t,n)=>{n.d(t,{p:()=>r});var i=n(11957),s=n(31889),a=n(63715),o=n(47219);function r(){const e=(0,i.o)((e=>e?.item??void 0),((e,t)=>e?.uri===t?.uri));return(0,o.p)(e)||(0,a.d)(e)?"audio"===e.mediaType||"mixed"===e.mediaType:!!(0,s.N)(e)&&e.isPodcastAd}},29842:(e,t,n)=>{n.d(t,{s:()=>s,u:()=>i});const i=e=>e.ui.lyrics.mode,s=e=>e.ui.lyrics.translationLanguage},32712:(e,t,n)=>{n.d(t,{sY:()=>x,Nh:()=>h,bo:()=>k,r3:()=>b,EX:()=>y,lZ:()=>v});var i=n(75044),s=n(24792);n(31491);const a=new s.l("queryFullscreenMode","query","5d8427bc0f6f2f6b96521121faf162094c2a3f14f0511b5ca0628c6a5028a3ea",null);var o=n(55405),r=n(11957),c=n(31889),l=n(63715),u=n(47219),d=n(24821),m=n(6725),g=n(29645),p=n(91563);const v=()=>{const e=(0,i.NC)(o.WYm,{loadingValue:!1});return(0,r.o)(g.A3)||e};function y(e){return(0,d.v)(e)?{uri:e.uri,name:e.name,creatorName:e.artists[0]?.name,coverArtImageUrl:e.images?.[0]?.url,duration:e.duration.milliseconds}:(0,u.p)(e)?{uri:e.uri,name:e.name,creatorName:e.show.name,coverArtImageUrl:e.images?.[0]?.url,duration:e.duration.milliseconds}:(0,l.d)(e)?{uri:e.uri,name:e.name,creatorName:e.book.name,coverArtImageUrl:e.images?.[0]?.url,duration:e.duration.milliseconds}:(0,c.N)(e)?{uri:e.uri,name:e.title??"",creatorName:e.advertiser??"",coverArtImageUrl:e.images?.[0]?.url,duration:e.duration.milliseconds}:(0,m.v)(e)||void 0===e?void 0:(0,p.d)(e)}function b(e){const t=y(e);return(0,d.v)(e)||(0,u.p)(e)||(0,l.d)(e)||(0,c.N)(e)?{...t,duration:e.duration.milliseconds,mediaType:(n=e.mediaType,"video"===n||"mixed"===n?"video":"audio")}:(0,m.v)(e)||void 0===e?void 0:(0,p.d)(e);var n}function h(e){const t=e?.context.metadata?.context_description,n=e?.context.uri||void 0,i=e?.positionAsOfTimestamp??void 0,s=e?.timestamp,a=e?.isPaused,o=e?.restrictions.canPause,r=e?.restrictions.canResume;return{contextName:t,contextUri:n,position:i,timestamp:s,isPaused:a,canPause:o,canResume:r}}async function x(e,t){return e(a,{artistUri:t}).then((e=>{if("Artist"===e?.data?.artistUnion.__typename){const t=e.data.artistUnion.headerImage;if("ImageV2"===t?.data?.__typename)return t?.data.sources[0]?.url}})).catch((()=>{}))}function k(e,t,n){if(e&&n&&n.hasLyrics)return{status:t?"loading":"success",content:{provider:n.provider,syncType:n.syncType,lines:n.lyrics.map((e=>({timestamp:Number(e.start),text:e.text})))}}}},39715:(e,t,n)=>{n.d(t,{z:()=>s});var i=n(31077);const s=()=>{const{togglePanel:e,isActive:t}=(0,i.C)();return{isPickerOpen:t,triggerRef:{current:null},toggleDevicePicker(t){e(t)}}}},49908:(e,t,n)=>{n.d(t,{A:()=>r});var i=n(85387),s=n(2849),a=n(49361),o=n(35397);function r({referrer:e,onChange:t}){const n=(0,i.Zp)(),{isActive:r,routeDestination:c}=(0,s.$)(),{setVideoPlayerUIFlag:l}=(0,a.d)(),u=()=>{r||(l(o.nP.cinemaLegacy,!1),n(c,{state:{referrer:e}}),t?.(c))},d=()=>{r&&(n(-1),t?.(null))};return{isActive:r,showLyrics:u,hideLyrics:d,toggleLyrics:()=>{r?d():u()}}}},52630:(e,t,n)=>{n.d(t,{S:()=>o,z:()=>r});var i=n(12599),s=n(43352),a=n(57863);const o=async(e,t,n,o)=>{const r=(0,i.o_h)(e).id,c=s.n.getInstance(),l={format:"json",vocalRemoval:n};o&&(l.clientLanguage=o);return(await c.build().withHost(a.Hj).withPath(`/track/${encodeURIComponent(r)}/image/${encodeURIComponent(t)}`).withQueryParameters(l).withEndpointIdentifier("/track/{trackId}").send()).body},r=async e=>{const t=(0,i.Y8v)((0,i.o_h)(e)?.id);if(!t)return!1;const n=s.n.getInstance(),o=await n.build().withHost(a.XE).withPath(`/track/${encodeURIComponent(t)}`).withEndpointIdentifier("/track/{trackId}").send();return o.body?.has_lyrics||!1}},56970:(e,t,n)=>{n.d(t,{X:()=>o});var i=n(75044),s=n(55405),a=n(64777);const o=()=>{const e=(0,a.S)(),{isSupported:t}=e.getCapabilities();return(0,i.NC)(s.OBX,{loadingValue:!1})&&t}},62461:(e,t,n)=>{n.d(t,{H:()=>s,k:()=>i});const i=18e5,s=6e5},71267:(e,t,n)=>{n.d(t,{D:()=>u});var i=n(30758),s=n(52223);var a=n(49361),o=n(35397),r=n(12543),c=n(61542),l=n(5141);const u=({item:e,onClick:t})=>{const n=(0,r.W)(),{capabilities:{isEnabled:u},isOpen:d,close:m,open:g,canOpen:p}=(0,c.H)(),{videoPlayerMode:v}=(0,a.d)(),{spec:y,logger:b}=(0,l.r)(s.h9,{data:{identifier:v===o.Kz.cinemaLegacy?s.gw.CINEMA:s.gw.DESKTOP}}),h=(0,i.useCallback)((()=>{let i;u&&(d?(m(),e?.uri&&b.logInteraction(y.pipButtonFactory({uri:e.uri}).hitUiHide()),i="close-picture-in-picture"):(g(),e?.uri&&(({spec:e,logger:t,uri:n})=>{const i=window.documentPictureInPicture;if(!i)return;const s=a=>{setTimeout((()=>{const i=a.window?.innerWidth,s=a.window?.innerHeight;if(!i||!s)return;const o=e.pipButtonFactory({uri:n}).hitUiOpenWindow({widthPx:i,heightPx:s});t.logInteraction(o)}),100),i.removeEventListener("enter",s)};i.addEventListener("enter",s)})({spec:y,logger:b,uri:e.uri}),i="show-picture-in-picture"),t?.(!d,e?.uri),n({type:"click",intent:i,targetUri:e?.uri,itemIdSuffix:"picture-in-picture-toggle"}))}),[m,u,d,e?.uri,b,t,n,g,y]);return{showButton:p,isActive:d,onClick:h}}},72322:(e,t,n)=>{n.d(t,{I:()=>b});var i=n(16318),s=n(75044),a=n(62461),o=n(13225),r=n(56970),c=n(52630),l=n(12878),u=n(97216),d=n(48563);function m(e,t,n){const{startTimeMs:i,words:s}=e,a=n[t+1];return{start:i||0,end:a&&a.startTimeMs?a.startTimeMs:1/0,text:s}}function g(e){return u.Q.fromInt(e).toCSS(d.a.RGB)}var p=n(87983),v=n(81481);const y={hasLyrics:!1},b=(e,t)=>{const n=(0,p.h)(t||void 0,{desiredLabel:"large",desiredSize:600})??t?.[0]?.url??"",u=(0,r.X)(),d=(0,s.NC)(v.Tc,{loadingValue:v.LZ.CONTROL}),b={[v.LZ.CONTROL]:void 0,[v.LZ.SYSTEM_LANGUAGE]:navigator.language,[v.LZ.ALL_LANGUAGES]:"all"}[d],h=["lyrics",{uri:e,image:n,vocalRemoval:u}],{hasLyrics:x,isLoading:k}=(0,o.f)(e),{data:C,isLoading:N,isError:f}=(0,i.I)({queryKey:h,queryFn:async()=>{if(!e||!n)return y;const t=await async function(e,t,n=!1,i){try{const o=await(0,c.S)(e,t,n,i);return{hasLyrics:!0,isTimeSynced:(a=o.lyrics.syncType,"LINE_SYNCED"===a||"SYLLABLE_SYNCED"===a),syncType:o.lyrics.syncType,lyrics:o.lyrics.lines.map(m),colors:(s=o.colors,{text:g(s.text),activeText:g(s.highlightText),background:g(s.background)}),provider:o.lyrics.provider,providerDisplayName:o.lyrics.providerDisplayName,providerLyricsId:o.lyrics.providerLyricsId,hasVocalRemoval:o.hasVocalRemoval??!1,showUpsell:o.lyrics.showUpsell??!1,alternatives:o.lyrics.alternatives}}catch(e){if(e instanceof l.O&&404===e.status)return{hasLyrics:!1};throw e}var s,a}(e,n,u,b);return t},gcTime:a.k,staleTime:a.H,enabled:x}),I=k||N;let j=null;return I||(j=x?C??null:y),{data:j,loading:I,error:f}}},98965:(e,t,n)=>{n.d(t,{J:()=>a});var i=n(72322),s=n(11957);const a=()=>{const e=(0,s.o)((e=>e?.item),((e,t)=>e?.uri===t?.uri));return(0,i.I)(e?.uri,e?.images)}}}]);
//# sourceMappingURL=dwp-now-playing-bar.js.map