"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[3322],{1196:(e,t,i)=>{i.d(t,{I:()=>b});var a=i(16318),n=i(93960),r=i(57537),s=i(14413),o=i(74865),c=i(20514),l=i(82786),u=i(74549),d=i(97143);function m(e,t,i){const{startTimeMs:a,words:n}=e,r=i[t+1];return{start:a||0,end:r&&r.startTimeMs?r.startTimeMs:1/0,text:n}}function g(e){return u.Q.fromInt(e).toCSS(d.a.RGB)}var p=i(74891),v=i(34645);const y={hasLyrics:!1},b=(e,t)=>{const i=(0,p.h)(t||void 0,{desiredLabel:"large",desiredSize:600})??t?.[0]?.url??"",u=(0,o.X)(),d=(0,n.NC)(v.Tc,{loadingValue:v.LZ.CONTROL}),b={[v.LZ.CONTROL]:void 0,[v.LZ.SYSTEM_LANGUAGE]:navigator.language,[v.LZ.ALL_LANGUAGES]:"all"}[d],h=["lyrics",{uri:e,image:i,vocalRemoval:u}],{hasLyrics:k,isLoading:x}=(0,s.f)(e),{data:C,isLoading:N,isError:f}=(0,a.I)({queryKey:h,queryFn:async()=>{if(!e||!i)return y;const t=await async function(e,t,i=!1,a){try{const s=await(0,c.S)(e,t,i,a);return{hasLyrics:!0,isTimeSynced:(r=s.lyrics.syncType,"LINE_SYNCED"===r||"SYLLABLE_SYNCED"===r),syncType:s.lyrics.syncType,lyrics:s.lyrics.lines.map(m),colors:(n=s.colors,{text:g(n.text),activeText:g(n.highlightText),background:g(n.background)}),provider:s.lyrics.provider,providerDisplayName:s.lyrics.providerDisplayName,providerLyricsId:s.lyrics.providerLyricsId,hasVocalRemoval:s.hasVocalRemoval??!1,showUpsell:s.lyrics.showUpsell??!1,alternatives:s.lyrics.alternatives}}catch(e){if(e instanceof l.O&&404===e.status)return{hasLyrics:!1};throw e}var n,r}(e,i,u,b);return t},gcTime:r.k,staleTime:r.H,enabled:k}),I=x||N;let j=null;return I||(j=k?C??null:y),{data:j,loading:I,error:f}}},11895:(e,t,i)=>{i.d(t,{z:()=>n});var a=i(34945);const n=()=>{const{togglePanel:e,isActive:t}=(0,a.C)();return{isPickerOpen:t,triggerRef:{current:null},toggleDevicePicker(t){e(t)}}}},14413:(e,t,i)=>{i.d(t,{f:()=>u});var a=i(16318),n=i(83441),r=i(93960),s=i(31014),o=i(57537),c=i(20514),l=i(17145);const u=e=>{const t=!!e&&(0,s.U_m)(e),i=(0,r.NC)(l.s6w)&&t,{data:u,isLoading:d}=(0,a.I)({queryKey:["useLyricsAvailability",e],queryFn:async()=>!!e&&await(0,c.z)(e),gcTime:o.k,staleTime:o.H,enabled:i,placeholderData:n.rX});return{isLoading:d,hasLyrics:!!i&&(u??!1)}}},15113:(e,t,i)=>{i.d(t,{J:()=>r});var a=i(1196),n=i(92505);const r=()=>{const e=(0,n.o)((e=>e?.item),((e,t)=>e?.uri===t?.uri));return(0,a.I)(e?.uri,e?.images)}},20514:(e,t,i)=>{i.d(t,{S:()=>s,z:()=>o});var a=i(31014),n=i(68265),r=i(81907);const s=async(e,t,i,s)=>{const o=(0,a.o_h)(e).id,c=n.n.getInstance(),l={format:"json",vocalRemoval:i};s&&(l.clientLanguage=s);return(await c.build().withHost(r.Hj).withPath(`/track/${encodeURIComponent(o)}/image/${encodeURIComponent(t)}`).withQueryParameters(l).withEndpointIdentifier("/track/{trackId}").send()).body},o=async e=>{const t=(0,a.Y8v)((0,a.o_h)(e)?.id);if(!t)return!1;const i=n.n.getInstance(),s=await i.build().withHost(r.XE).withPath(`/track/${encodeURIComponent(t)}`).withEndpointIdentifier("/track/{trackId}").send();return s.body?.has_lyrics||!1}},20883:(e,t,i)=>{i.d(t,{sY:()=>k,Nh:()=>h,bo:()=>x,r3:()=>b,EX:()=>y,lZ:()=>v});var a=i(93960),n=i(5820);i(33031);const r=new n.l("queryFullscreenMode","query","5d8427bc0f6f2f6b96521121faf162094c2a3f14f0511b5ca0628c6a5028a3ea",null);var s=i(17145),o=i(92505),c=i(63365),l=i(55),u=i(37639),d=i(12689),m=i(4945),g=i(88689),p=i(43943);const v=()=>{const e=(0,a.NC)(s.WYm,{loadingValue:!1});return(0,o.o)(g.A3)||e};function y(e){return(0,d.v)(e)?{uri:e.uri,name:e.name,creatorName:e.artists[0]?.name,coverArtImageUrl:e.images?.[0]?.url,duration:e.duration.milliseconds}:(0,u.p)(e)?{uri:e.uri,name:e.name,creatorName:e.show.name,coverArtImageUrl:e.images?.[0]?.url,duration:e.duration.milliseconds}:(0,l.d)(e)?{uri:e.uri,name:e.name,creatorName:e.book.name,coverArtImageUrl:e.images?.[0]?.url,duration:e.duration.milliseconds}:(0,c.N)(e)?{uri:e.uri,name:e.title??"",creatorName:e.advertiser??"",coverArtImageUrl:e.images?.[0]?.url,duration:e.duration.milliseconds}:(0,m.v)(e)||void 0===e?void 0:(0,p.d)(e)}function b(e){const t=y(e);return(0,d.v)(e)||(0,u.p)(e)||(0,l.d)(e)||(0,c.N)(e)?{...t,duration:e.duration.milliseconds,mediaType:(i=e.mediaType,"video"===i||"mixed"===i?"video":"audio")}:(0,m.v)(e)||void 0===e?void 0:(0,p.d)(e);var i}function h(e){const t=e?.context.metadata?.context_description,i=e?.context.uri||void 0,a=e?.positionAsOfTimestamp??void 0,n=e?.timestamp,r=e?.isPaused,s=e?.restrictions.canPause,o=e?.restrictions.canResume;return{contextName:t,contextUri:i,position:a,timestamp:n,isPaused:r,canPause:s,canResume:o}}async function k(e,t){return e(r,{artistUri:t}).then((e=>{if("Artist"===e?.data?.artistUnion.__typename){const t=e.data.artistUnion.headerImage;if("ImageV2"===t?.data?.__typename)return t?.data.sources[0]?.url}})).catch((()=>{}))}function x(e,t,i){if(e&&i&&i.hasLyrics)return{status:t?"loading":"success",content:{provider:i.provider,syncType:i.syncType,lines:i.lyrics.map((e=>({timestamp:Number(e.start),text:e.text})))}}}},23605:(e,t,i)=>{i.d(t,{$:()=>r});var a=i(85387);const n="/lyrics",r=()=>{const e=(0,a.zy)(),t=e.pathname.startsWith(n);return{isActive:t,isActiveNotCinemaMode:t&&!e.state.cinemaState,routeDestination:n}}},36360:(e,t,i)=>{i.d(t,{A:()=>o});var a=i(85387),n=i(23605),r=i(21709),s=i(87761);function o({referrer:e,onChange:t}){const i=(0,a.Zp)(),{isActive:o,routeDestination:c}=(0,n.$)(),{setVideoPlayerUIFlag:l}=(0,r.d)(),u=()=>{o||(l(s.nP.cinemaLegacy,!1),i(c,{state:{referrer:e}}),t?.(c))},d=()=>{o&&(i(-1),t?.(null))};return{isActive:o,showLyrics:u,hideLyrics:d,toggleLyrics:()=>{o?d():u()}}}},45105:(e,t,i)=>{i.d(t,{p:()=>o});var a=i(92505),n=i(63365),r=i(55),s=i(37639);function o(){const e=(0,a.o)((e=>e?.item??void 0),((e,t)=>e?.uri===t?.uri));return(0,s.p)(e)||(0,r.d)(e)?"audio"===e.mediaType||"mixed"===e.mediaType:!!(0,n.N)(e)&&e.isPodcastAd}},49662:(e,t,i)=>{i.d(t,{s:()=>n,u:()=>a});const a=e=>e.ui.lyrics.mode,n=e=>e.ui.lyrics.translationLanguage},52697:(e,t,i)=>{i.d(t,{w:()=>u});var a=i(30758),n=i(2265),r=i(79252),s=i(35953),o=i(74268),c=i(19813),l=i(3161);const u=({uri:e,isBook:t})=>{const{add:i,remove:u}=(0,c.p)("prerelease"),d=(0,o.o)("prerelease",[e]).at(0),{enqueueSnackbar:m}=(0,s.d)(),{spec:g,logger:p}=(0,l.r)(n.k,{data:{uri:e}});return{isPreSaved:d,addPresave:(0,a.useCallback)((async()=>{p.logInteraction(g.actionBarFactory().preSaveButtonFactory().hitPresave({prereleaseId:e,itemToBePresaved:e,contextUri:e})),await i(e),m(t?r.Ru.get("web-player.prerelease.audiobook_feedback_presaved"):r.Ru.get("web-player.prerelease.album_feedback_presaved"))}),[i,m,t,p,g,e]),removePresave:(0,a.useCallback)((async()=>{p.logInteraction(g.actionBarFactory().preSaveButtonFactory().hitRemovePresave({prereleaseId:e,itemToBeRemovedFromPresaved:e,contextUri:e})),await u(e)}),[p,u,g,e])}}},57537:(e,t,i)=>{i.d(t,{H:()=>n,k:()=>a});const a=18e5,n=6e5},66507:(e,t,i)=>{i.d(t,{f:()=>m});var a=i(30758),n=i(97500),r=i.n(n),s=i(10728),o=i(56962);const c="main-genericButton-button",l="main-genericButton-buttonActive",u="main-genericButton-buttonActiveDot";var d=i(86070);const m=(0,a.forwardRef)(((e,t)=>{const i=e.isActive??!1,a=r()(c,{[l]:i||e.isActiveNoIndicator,[u]:i},e.className);return(0,d.jsx)(o.Zp,{label:e.label,children:(0,d.jsx)(s.H,{ref:t,style:e.style,"aria-label":e.label,size:"small",className:a,disabled:e.disabled,iconOnly:e.icon,onClick:e.onToggle,"data-testid":e.testId,"data-active":i.toString(),"aria-pressed":i,"data-restore-focus-key":e.restoreFocusKey})})}))},74865:(e,t,i)=>{i.d(t,{X:()=>s});var a=i(93960),n=i(17145),r=i(8477);const s=()=>{const e=(0,r.S)(),{isSupported:t}=e.getCapabilities();return(0,a.NC)(n.OBX,{loadingValue:!1})&&t}},75098:(e,t,i)=>{i.d(t,{NowPlayingBar:()=>pn});var a=i(30758),n=i(97500),r=i.n(n),s=i(62411),o=i(94079),c=i(85047),l=i(77812),u=i(82499),d=i(79252);const m="dz_h98rH9nZCwfPdnKgr",g="rAfV2jB_HMM9Xtr0Rqvn",p="XkXPpDRWozMF6G8_GlLQ";var v=i(86070);const y=a.memo((function(e){const{handleClick:t}=e,i=d.Ru.get("pta.bottom-bar.title"),a=d.Ru.get("fta.bottom-bar.subtitle"),n=d.Ru.get("fta.sign-up-free");return(0,v.jsxs)("div",{className:m,onClick:t,"data-testid":"signup-bar",children:[(0,v.jsxs)("div",{className:g,children:[(0,v.jsx)(l.E,{as:"p",variant:"bodySmallBold",children:i}),(0,v.jsx)(l.E,{as:"p",variant:"bodyMedium",dangerouslySetInnerHTML:{__html:a}})]}),(0,v.jsx)(u.$,{colorSet:"invertedLight",onClick:t,className:p,children:n})]})}));var b=i(19315),h=i(7392),k=i(26761),x=i(74520),C=i(11895),N=i(36632),f=i(71726),I=i(3161);const j="gqYYMz8DkhaT3e44LcHQ",A="VX33mI2V_jRA7hRBI9_0",S=({remoteDeviceName:e,remoteDeviceType:t,connectionStatus:i,omitConnectionStateText:a=!1})=>{const{spec:n,logger:r}=(0,I.r)(k.s,{}),{triggerRef:s,toggleDevicePicker:o,isPickerOpen:c}=(0,C.z)(),u=(0,N.$A)(t,i),m=i===f.zP.CONNECTED?d.Ru.get("web-player.connect.bar.connected-state",{device_name:e}):d.Ru.get("web-player.connect.bar.connecting-state",{device_name:e});return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(u,{size:"small",className:A,role:"presentation",semanticColor:"essentialBase"}),(0,v.jsx)(h.Y,{component:"button",onClick:()=>{const e=n.activeDeviceButtonFactory(),{interactionId:t}=r.logInteraction(c?e.hitUiHide():e.hitUiReveal()),i=c;o(t),i||(0,x.I)("DEVICE-PICKER")},ref:s,className:j,children:(0,v.jsx)(l.E,{variant:"bodySmallBold","aria-live":"polite",semanticColor:"textBase",children:a&&i===f.zP.CONNECTED?e:m})})]})},w="nQSM_BrSHJ4Cp3XSuLOF",T=()=>(0,v.jsxs)("svg",{width:"1",height:"16",viewBox:"0 0 1 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",role:"separator",className:w,children:[(0,v.jsx)("g",{id:"separator",clipPath:"url(#clip0_491_88335)",children:(0,v.jsx)("rect",{id:"Rectangle 111112858",width:"1",height:"16",rx:"0.5",fill:"var(--essential-base)"})}),(0,v.jsx)("defs",{children:(0,v.jsx)("clipPath",{id:"clip0_491_88335",children:(0,v.jsx)("rect",{width:"1",height:"16",fill:"white"})})})]});var P=i(21395),D=i(26729),L=i(70961),E=i(66225),R=i(13478);const B="main-connectBar-connectBar",_="main-connectBar-connected",O="main-connectBar-connecting",U=function(){const{isPlayingRemotely:e,connectionStatus:t,remoteDeviceName:i,remoteDeviceType:a}=(0,L.v)((e=>{const t=(0,D.V)(e);return{isPlayingRemotely:t.isPlayingRemotely,connectionStatus:t.connectionStatus,remoteDeviceName:t.remoteDevice?.name,remoteDeviceType:t.remoteDevice?.type}}),R.a),{currentSession:n}=(0,E.D)(),s=Boolean(n?.active),o=e&&i&&a;if(!o&&!s)return null;const c=t===f.zP.CONNECTED||s,l=t===f.zP.CONNECTING&&!s;return(0,v.jsxs)("div",{className:r()(B,{"encore-bright-accent-set":c,[_]:c,[O]:l}),children:[s&&(0,v.jsx)(P.K,{}),s&&o&&(0,v.jsx)(T,{}),o&&(0,v.jsx)(S,{connectionStatus:t,remoteDeviceName:i,remoteDeviceType:a,omitConnectionStateText:s})]})},F=()=>(0,v.jsx)(a.Suspense,{fallback:null,children:(0,v.jsx)(U,{})});var M=i(40638),z=i(93960),V=i(2597),G=i(46250),Q=i(66105),H=i(50863),q=i(20883),K=i(66507),Y=i(4370),Z=i(85281),W=i(82101),X=i(60169),J=i(97724),$=i(17145),ee=i(99329),te=i(92505);const ie=({className:e="",disabledClassName:t="",onClick:i})=>{const n=(0,q.lZ)(),o=(0,a.useContext)(H.s),c=(0,te.o)((e=>e?.hasContext??!1)),l=(0,s.wA)(),u=(0,z.NC)($.mzn),m=(0,X.l)(),g=!c,{toggleFullScreen:p,isInFullScreen:y}=(0,J.H)({refOrElement:document.body,shouldWakeLockScreen:!0}),b=(0,a.useCallback)((()=>{const e=y?W.z.CLOSED:W.z.NOW_PLAYING_VIEW;p(),setTimeout((()=>{m(e)}),1)}),[y,m,p]),h=(0,a.useCallback)((()=>{o?.current&&(l((0,Q.f)()),(0,ee.X8)(o.current))}),[l,o]),k=(0,a.useCallback)((async()=>{c&&(i?.(!0),u?b():h())}),[c,i,u,b,h]),x=y?Y.z:Z.T,C=y?d.Ru.get("web-player.cinema-mode.fullscreen.exit"):d.Ru.get("web-player.cinema-mode.fullscreen.enter"),N=r()(e,{[t]:g});return n?(0,v.jsx)(K.f,{onToggle:k,className:N,icon:u?x:G.L,label:u?C:d.Ru.get("npv.full-screen"),disabled:g,testId:"fullscreen-mode-button"}):null},ae=(0,a.memo)(ie);var ne=i(75119),re=i(94677),se=i(34945);var oe=i(83867),ce=i(10728),le=i(80013);const ue="xP7v0EBcbJMj1xIJxywg",de="zJU_lLLzQL6oKvMA0c5b",me=({onClose:e,onMouseEnter:t,onMouseLeave:i,onClick:a,impressionCallback:n,message:r})=>(0,v.jsxs)("div",{className:ue,onMouseEnter:t,onMouseLeave:i,ref:n,onClick:a,children:[(0,v.jsx)(l.E,{id:"nudgeBody",as:"p",variant:"bodyMedium",semanticColor:"textBase",children:r}),(0,v.jsx)(ce.H,{iconOnly:le.M,size:"small",semanticColor:"textBase",onClick:t=>{t.stopPropagation(),e?.()},"aria-label":d.Ru.get("close"),className:de})]});var ge=i(61196),pe=i(61871);const ve=(e=ge.C)=>{const t=(0,s.Pj)(),{isActive:i}=e(),a=(0,pe.h)();return document.hasFocus()&&!i&&!(({ui:e,ads:t},i)=>e.blockUserDialog.isOpen||e.connectDevicePicker.isOpen||e.deleteFolderDialog.isOpen||e.deletePlaylistDialog.isOpen||e.fullscreenMode.isOpen||e.improvedSignupPromptDialog.isOpen||e.keyboardShortcutsHelpModal.isOpen||e.leavePlaylistDialog.isOpen||e.offlineDeviceLimitReachedDialog.isOpen||e.playbackNotSupportedErrorDialog.isOpen||e.premiumDialog.isOpen||!0===t.billboard?.isOpen&&!t.billboard.isMinimized||!1===t.vto?.isHidden&&!1===t.vto?.isMinimized||i)(t.getState(),a.current.length>0)};var ye=i(20137);var be=i(83660),he=i(82429),ke=i(7954),xe=i(40596),Ce=i(65882),Ne=i(85978),fe=i(85927),Ie=i(88689);const je=e=>{const t=(0,a.useRef)(),i=(0,a.useRef)(),n=(0,a.useRef)(!1),r=(0,Ce.z)(),s=(0,he.Z)(),{spec:o,logger:c}=(0,I.r)(ye.w,{}),l=(0,a.useRef)(null),u=(0,a.useCallback)((()=>{c.logInteraction(o.djVoiceUnsupportedNudgeFactory().closeButtonFactory().hitUiHide())}),[o,c]),m=(0,a.useCallback)((e=>{e&&l.current!==e&&c.logImpression(o.djVoiceUnsupportedNudgeFactory().impression()),l.current=e}),[o,c]),g=(0,a.useCallback)((()=>{const e=r.getState(),t=s.getActiveDevice();return!(e=>e?.isLocal??!1)(t)&&(0,Ie.yc)(e,"spotify:playlist:37i9dQZF1EYkqdzj48dyYq")!==fe.i.NOT_ACTIVE&&!(e=>Boolean(e?.supportsDJNarration))(t??void 0)}),[r,s]),p=(0,a.useCallback)((()=>{g()&&e({nudgeType:"message-only-nudge",message:d.Ru.get("web-player.connect.nudge.dj-voice-unavailable"),onClose:u,impressionCallback:m})}),[e,g,u,m]),v=(0,a.useCallback)((e=>{e.data.action===xe.Ik.PLAY&&(n.current=!0)}),[]);(0,Ne.p)(xe.gd.ACTION,v);const y=(0,a.useCallback)((e=>{n.current&&(0,Ie.uW)(e.data)===fe.i.PLAYING&&(t.current=e.data?.context.uri,p(),t.current=void 0,n.current=!1)}),[p]);(0,Ne.p)(xe.gd.UPDATE,y);const b=(0,a.useCallback)((e=>{const t=e.data?.activeDevice;t&&!t.isLocal&&i.current!==t.connectStateId&&p(),i.current=t?.connectStateId}),[p]);(0,ke.W)(be.P.UPDATE,b)};var Ae=i(48391);const Se=e=>{switch(e.type){case f.bq.AUDIO_DONGLE:case f.bq.AVR:case f.bq.CAST_AUDIO:case f.bq.CAST_VIDEO:case f.bq.GAME_CONSOLE:case f.bq.SPEAKER:case f.bq.STB:case f.bq.TV:return!0;default:return!1}};var we=i(41290),Te=i(23700),Pe=i(76137);const De=new Date(0).toISOString(),Le=["shift+alt+f10"],Ee=e=>{const t=(0,a.useRef)(),i=(0,a.useRef)(!1),n=(0,a.useRef)(!1),r=(0,s.Pj)(),o=(0,Ce.z)(),c=(0,he.Z)(),l=(0,Te.V)(),[u,m]=(0,Pe.x)("connect-nudge-triggered-at",De),g=(0,a.useRef)(null),{spec:p,logger:v}=(0,I.r)(ye.w,{}),y=(0,a.useCallback)((()=>{v.logInteraction(p.connectFromDevicePickerNudgeFactory().hitNoAction())}),[p,v]),b=(0,a.useCallback)((()=>{v.logInteraction(p.connectFromDevicePickerNudgeFactory().closeButtonFactory().hitUiHide())}),[p,v]),h=(0,a.useCallback)((e=>{e&&g.current!==e&&v.logImpression(p.connectFromDevicePickerNudgeFactory().impression()),g.current=e}),[p,v]);(0,we.f)(Le,(async()=>{const{platform:{isDeveloperMode:e}}=r.getState();if(e){const e=new Date;e.setHours(e.getHours()-8),m(e.toISOString())}}));const k=(0,a.useCallback)((()=>{const e=o.getState(),t=c.getActiveDevice(),i=c.getDevices(),a=l.getDefaultDevice(),n=new Date(u);n.setHours(n.getHours()+8);return n<=new Date&&(e=>e?.isLocal??!1)(t)&&!(0,Ie.A3)(e)&&(e=>e.some((e=>e.isLocalNetwork&&!e.isDisabled&&Se(e))))(i)&&(e=>!e||!(e.terminalType===Ae.FI.HEADPHONES||e.terminalType===Ae.FI.SPEAKERS&&(e.transportType===Ae.Yg.BLUETOOTH||e.transportType===Ae.Yg.USB)))(a)}),[o,l,u,c]),x=(0,a.useCallback)((()=>{if(k()){e({nudgeType:"message-only-nudge",message:d.Ru.get("web-player.connect.nudge.listen-to-speaker"),impressionCallback:h,onClick:y,onClose:b});const t=(new Date).toISOString();m(t)}}),[e,k,m,y,b,h]),C=(0,a.useCallback)((e=>{e.data.action===xe.Ik.PLAY?i.current=!0:e.data.action===xe.Ik.RESUME&&(n.current=!0)}),[]);(0,Ne.p)(xe.gd.ACTION,C);const N=(0,a.useCallback)((e=>{i.current&&(0,Ie.uW)(e.data)===fe.i.PLAYING?(t.current=e.data?.context.uri,x(),t.current=void 0,i.current=!1):n.current&&!1===e.data?.isPaused&&(t.current=e.data?.context.uri,x(),t.current=void 0,n.current=!1)}),[x]);(0,Ne.p)(xe.gd.UPDATE,N)},Re=e=>{Ee(e),je(e)},Be=()=>{const e=(0,a.useRef)(),t=(0,a.useRef)(!1),i=(0,a.useRef)(!1),n=(0,s.wA)(),r=(0,s.d4)((e=>e.ui.connectNudge.isOpen)),o=(0,s.d4)((e=>e.ui.connectDevicePicker.isOpen)),c=(0,a.useCallback)((()=>{i.current&&(clearTimeout(e.current),i.current=!1),n((0,Q.Yp)())}),[n]),l=(0,a.useCallback)((()=>{i.current=!1,t.current||c()}),[c]),u=(0,a.useCallback)((()=>{e.current=window.setTimeout(l,8e3),n((0,Q.dK)()),i.current=!0}),[n,l]),d=(0,a.useCallback)((e=>{t.current=e,e||i.current||c()}),[c]);return(0,a.useEffect)((()=>{o&&c()}),[o,c]),(0,a.useMemo)((()=>({hideNudge:c,showNudge:u,setShouldKeepShowingNudge:d,isNudgeVisible:r})),[c,u,d,r])},_e=({children:e,useNudgeTriggers:t=Re,useToggleNudgeWithTimer:i=Be,useCanShowNudge:n=ve,disabled:r=!1})=>{const{showNudge:s,hideNudge:o,setShouldKeepShowingNudge:c,isNudgeVisible:l}=i(),[u,d]=(0,a.useState)(null),m=n();(0,a.useEffect)((()=>{l&&!m&&o()}),[m,o,l]),t((e=>!(l||!m)&&(d(e),s(),!0)));const g=(0,a.useCallback)((e=>{if(!e)return(0,v.jsx)(v.Fragment,{});return(0,v.jsx)(me,{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),...e,onClose:()=>{e?.onClose?.(),o()}})}),[o,c]);return(0,v.jsx)(oe.W,{placement:"top",visible:Boolean(u?.message)&&l&&!r,overlay:g(u),popperOptions:{modifiers:[{name:"preventOverflow",options:{rootBoundary:"viewport",altAxis:!0,padding:24,tether:!1}}]},onHide:()=>{},fadeOut:!0,useLazyMounting:!0,children:e})};var Oe=i(84277);const Ue=()=>{const{remoteDeviceType:e,remoteDeviceIsGroup:t,connectionStatus:i}=(0,L.v)((e=>{const t=(0,D.V)(e);return{remoteDeviceType:t.remoteDevice?.type,remoteDeviceIsGroup:t.remoteDevice?.isGroup,connectionStatus:t.connectionStatus}}),R.a),n=(0,re.g)(),{canTogglePanel:r,isActive:s,togglePanel:o}=(0,se.C)(),{spec:c,logger:l}=(0,I.r)(ne.p,{}),u=(0,a.useCallback)((()=>{const{interactionId:e}=l.logInteraction(function(e,t,i){return {interactionId:null,pageInstanceId:null};let a;return a=t===f.zP.CONNECTING?e.connectingButtonFactory():t===f.zP.CONNECTED?e.connectedButtonFactory():e.notConnectedButtonFactory(),i?a.hitUiHide():a.hitUiReveal()}(c,i,s));o(e)}),[i,o,s,c,l]),{currentDevice:m}=(0,Oe.l)(),{isLocal:g}=m,p=(0,a.useMemo)((()=>(0,N.tf)(e,t,g?n:null)),[n,g,t,e]);return(0,v.jsx)(_e,{children:(0,v.jsx)(K.f,{isActive:s,disabled:!r,onToggle:u,label:d.Ru.get("playback-control.connect-picker"),icon:p})})};var Fe=i(76321),Me=i(64232),ze=i(66108),Ve=i(39736),Ge=i(30767),Qe=i(27766);const He=ze.$S.PUFFIN_BUTTON_CLICK,qe=ze.$S.DEVICE_PICKER_BUTTON_CLICK,Ke=()=>{const{isPuffinPanelActive:e}=(0,Qe.c)(),{isActive:t,panelSend:i}=(0,Me.AI)(Ve.Z.DevicePicker,Ve.Z.DevicePickerOverlay),n=(0,Me.Ev)(He),{remoteDeviceType:r,remoteDeviceisGroup:s}=(0,L.v)((e=>{const t=(0,D.V)(e);return{remoteDeviceType:t.remoteDevice?.type,remoteDeviceisGroup:t.remoteDevice?.isGroup}}),R.a),o=(0,re.g)(),c=o?.audioDevice.terminalType===Ae.FI.HEADPHONES,l=(0,Ge.K)(),u=t||e,m=l||c,{currentDevice:g}=(0,Oe.l)(),{isLocal:p}=g,y=(0,a.useMemo)((()=>l?Fe.C:(0,N.tf)(r,s,p?o:null)),[o,l,s,r,p]);return(0,v.jsx)(K.f,{isActive:u,isActiveNoIndicator:m,onToggle:()=>{const e=t;i(qe),e||(0,x.I)("DEVICE-PICKER")},label:d.Ru.get("playback-control.connect-picker"),icon:y,disabled:!n,restoreFocusKey:e?Ve.Z.Puffin:Ve.Z.DevicePicker})};var Ye=i(89040),Ze=i(94705);const We=()=>{const{isAnonymous:e}=(0,s.d4)(Ze.Ht),t=(0,Ye.v)();return e?null:t?(0,v.jsx)(a.Suspense,{fallback:null,children:(0,v.jsx)(Ke,{})}):(0,v.jsx)(Ue,{})};var Xe=i(57909),Je=i(31014),$e=i(23605),et=i(14413),tt=i(15113);const it=a.memo((({onClick:e,className:t,isActive:i,isEnabled:a})=>{const n=a?d.Ru.get("web-player.lyrics.title"):d.Ru.get("web-player.lyrics.noLyrics1"),r=a?e:void 0;return(0,v.jsx)(K.f,{className:t,isActive:i,onToggle:r,disabled:!a,label:n,testId:"lyrics-button",icon:Xe.q})})),at=a.memo((e=>{const t=Boolean((0,tt.J)().data?.hasLyrics);return(0,v.jsx)(it,{...e,isEnabled:t,isActive:!1})})),nt=a.memo((e=>{const t=(0,te.o)((e=>e?.item?.uri)),i=Boolean((0,et.f)(t).hasLyrics);return(0,v.jsx)(it,{...e,isEnabled:i,isActive:!1})})),rt=a.memo((e=>{const{isActiveNotCinemaMode:t}=(0,$e.$)(),{isAnonymous:i}=(0,s.d4)(Ze.Ht),a=(0,z.NC)($.khs),n=(0,te.o)((e=>{if(e?.item?.uri&&(0,Je.U_m)(e?.item?.uri)){return!Boolean(e?.item?.metadata?.["segment.index"])}return!1}));return i||!n?null:t?(0,v.jsx)(it,{...e,isActive:t,isEnabled:!0}):a?(0,v.jsx)(at,{...e}):(0,v.jsx)(nt,{...e})}));var st=i(36360);const ot=({onClick:e,className:t})=>{const{toggleLyrics:i}=(0,st.A)({onChange:e,referrer:"now_playing_bar"});return(0,v.jsx)(rt,{onClick:i,className:t})};var ct=i(55666),lt=i(5106),ut=i(57160);const dt=ze.$S.NPV_BUTTON_CLICK,mt=({onClick:e})=>{const{isActive:t,panelSend:i}=(0,Me.AI)(Ve.Z.NowPlayingView),a=(0,Me.Ev)(dt),{mode:n,setMode:r}=(0,lt.r)(),s=(0,z.NC)($.ZDY),{item:o}=(0,te.o)((e=>({item:e?.item})),((e,t)=>e.item?.uri===t.item?.uri)),c=!o||!a;return s?null:(0,v.jsx)(K.f,{isActive:t,disabled:c,onToggle:()=>{e?.(!t),i(dt),n===ut.YU.cinema&&r(ut.YU.npv)},icon:ct.d,label:d.Ru.get("web-player.now-playing-view.label"),testId:"control-button-npv",restoreFocusKey:Ve.Z.NowPlayingView})};var gt=i(85387),pt=i(61024),vt=i(29111),yt=i(90303),bt=i(20535),ht=i(33924),kt=i(48540),xt=i(77342);const Ct=({uri:e,to:t,children:i,onDrop:n,onNavigate:r,className:o})=>{const[c,l]=(0,a.useState)(!1),u=(0,a.useRef)(null),d=(0,ht.g)(),m=(0,s.wA)(),g=(0,kt.f)(),p=(0,xt.g)(),y=(0,Ce.z)(),b=function(e){const t=(0,Je.o_h)(e),i=(0,s.d4)(Ze.F6);switch(t?.type){case Je.NQG.PLAYLIST:case Je.NQG.PLAYLIST_V2:{let e;if((0,Je.iwx)(t)&&(e=t.username),i&&e===i)return[bt.Ay[Je.NQG.TRACK],bt.Ay[Je.NQG.LOCAL],bt.Ay[Je.NQG.ALBUM]];break}case Je.NQG.COLLECTION:return[bt.Ay[Je.NQG.TRACK],bt.Ay[Je.NQG.ALBUM],bt.Ay[Je.NQG.ARTIST],bt.Ay[Je.NQG.PLAYLIST],bt.Ay[Je.NQG.PLAYLIST_V2],bt.Ay[Je.NQG.SHOW]];case Je.NQG.QUEUE:return[bt.Ay[Je.NQG.TRACK],bt.Ay[Je.NQG.LOCAL],bt.Ay[Je.NQG.EPISODE]];default:return[]}return[]}(e),h=!!b.length;return(0,a.useEffect)((()=>(c?u.current=window.setTimeout((()=>{(0,Je.U_m)(e)||(r?.(),d(t||(0,Je.o_h)(e).toURLPath(!0)))}),1e3):!c&&u.current&&clearTimeout(u.current),()=>{u.current&&clearTimeout(u.current)})),[c,e,t,r,d]),h?(0,v.jsx)(yt.A,{types:b,onDrop:t=>{const i=(0,Je.o_h)(e),a=Array.from(t.dataTransfer.types).find((e=>b.includes(e))),r=a&&t.dataTransfer.getData(a),s=r&&r.split("\n")[0],o=(0,Je.o_h)(s);if(o&&i)switch(n?.(o.toURI()),i.type){case Je.NQG.PLAYLIST:case Je.NQG.PLAYLIST_V2:m((0,vt.io)(e,[o.toURI()]));break;case Je.NQG.COLLECTION:(0,Je._Tv)(o)||(0,Je.ecE)(o)||(0,Je.U_m)(o)?g.add({uris:[o.toURI()]}):(0,Je.tbX)(o)?p.add([o.toURI()],{before:"start"}):(0,Je.WB1)(o)&&g.add({uris:[o.toURI()]});break;case Je.NQG.QUEUE:y.addToQueue([{uri:o.toURI(),uid:null}])}},onDragEnter:()=>{l(!0)},onDragLeave:()=>{l(!1)},className:o,children:i}):(0,v.jsx)("div",{children:i})};var Nt=i(92915);function ft({style:e,active:t,disabled:i,intent:n,label:r,labelActive:s,icon:o,iconActive:c,className:l,onClick:u}){const[d,m]=(0,a.useState)(!1),g=(0,Nt.W)(),p=t&&s?s:r,y=t&&c?c:o;return(0,v.jsx)(K.f,{style:e,className:l,isActive:t,disabled:i,onToggle:e=>{u?.(),d||e.target.blur(),m(!1),n&&g({type:"click",intent:n,targetUri:""})},onKeyDown:({key:e})=>{"enter"===e.toLowerCase()&&m(!0)},label:p,icon:y,testId:`control-button-${n}`})}var It=i(34506),jt=i(21709),At=i(87761),St=i(34988);const wt=()=>{const{isAnonymous:e}=(0,s.d4)(Ze.Ht),{videoPlayerMode:t}=(0,jt.d)();return e||t===At.Kz.cinemaLegacy?{isVisible:!1}:{isVisible:!0,isEnabled:!0}},Tt=({onClick:e})=>{const{isEnabled:t,isVisible:i}=wt(),n=(0,gt.zy)(),r=(0,St.J)(),s=(0,ht.g)(),o=(0,a.useMemo)((()=>"/queue"===n.pathname||"/history"===n.pathname),[n.pathname]),c=(0,a.useCallback)((()=>{const t=r.entries?.slice(0,r.index+1)?.reverse()?.findIndex((({pathname:e})=>"/queue"!==e&&"/history"!==e));e({mode:"main",route:null}),s(-1===t?"/":t>=0?-t:-1)}),[s,r,e]),l=(0,a.useCallback)((()=>{e({mode:"main",route:"/queue"}),s("/queue",{state:{referrer:"now_playing_bar"}})}),[e,s]),u=(0,a.useCallback)((()=>{t&&(o?c():l())}),[t,o,c,l]);return i?(0,v.jsx)(Ct,{uri:"spotify:queue",children:(0,v.jsx)(ft,{intent:"queue",icon:pt.j,label:d.Ru.get("playback-control.queue"),onClick:u,active:o,disabled:!t})}):null},Pt=ze.$S.QUEUE_BUTTON_CLICK,Dt=({onClick:e})=>{const{isEnabled:t,isVisible:i}=wt(),n=(0,Me.Ev)(Pt),{isActive:r}=(0,Me.AI)(Ve.Z.Queue,Ve.Z.QueueOverlay),{toggleQueue:s}=(0,It.R)(),o=(0,a.useCallback)((()=>{t&&(e({mode:"panel",aboutToShow:!r}),s())}),[t,e,r,s]);return i?(0,v.jsx)(Ct,{uri:"spotify:queue",children:(0,v.jsx)(K.f,{icon:pt.j,label:d.Ru.get("playback-control.queue"),onToggle:o,isActive:r,disabled:!t||!n,testId:"control-button-queue",restoreFocusKey:Ve.Z.Queue})}):null},Lt=({onClick:e})=>(0,z.NC)($.eWj)?(0,v.jsx)(Dt,{onClick:e}):(0,v.jsx)(Tt,{onClick:e});var Et=i(59330),Rt=i(87009),Bt=i(81353);const _t=({onClick:e})=>{const{item:t}=(0,Rt.L)()??{},{isActive:i,onClick:a,showButton:n}=(0,Bt.D)({item:t,onClick:e});return t&&n?(0,v.jsx)(K.f,{isActive:i,onToggle:a,label:i?d.Ru.get("miniplayer.close"):d.Ru.get("miniplayer.open"),icon:Et.F,testId:"pip-toggle-button"}):null};var Ot=i(12889),Ut=i(35907);const Ft="main-nowPlayingBar-extraControls",Mt="main-nowPlayingBar-lyricsButton",zt="main-nowPlayingBar-volumeBar",Vt=()=>{const e=(0,z.NC)($.yux),{setVideoPlayerUIFlag:t,videoPlayerMode:i}=(0,jt.d)(),{spec:n,logger:r,UBIFragment:s}=(0,I.r)(V.h9,{data:{identifier:i===At.Kz.cinemaLegacy?V.gw.CINEMA:V.gw.DESKTOP}}),o=(0,M.YQ)((e=>{r.logInteraction(n.volumeBarFactory().dragSetVolume({newVolumePercentage:Math.floor(100*e)}))}),500,{leading:!1,trailing:!0}),c=(0,a.useCallback)((e=>{e&&t(At.nP.cinemaLegacy,!1)}),[t]);return(0,v.jsx)(s,{spec:n,children:(0,v.jsxs)("div",{className:Ft,children:[(0,v.jsx)(Ut.mA,{onClick:()=>{r.logInteraction(n.djJumpButtonFactory().hitRefreshContent())}}),(0,v.jsx)(mt,{onClick:e=>{e?r.logInteraction(n.npvButtonFactory().hitUiReveal()):r.logInteraction(n.npvButtonFactory().hitUiHide())}}),!e&&(0,v.jsx)(ot,{className:Mt,onClick:e=>{e?r.logInteraction(n.lyricsButtonFactory().hitUiNavigate({destination:e})):r.logInteraction(n.lyricsButtonFactory().hitUiNavigateBack())}}),(0,v.jsx)(Lt,{onClick:e=>{"main"===e.mode?e.route?r.logInteraction(n.queueButtonFactory().hitUiNavigate({destination:e.route})):r.logInteraction(n.queueButtonFactory().hitUiNavigateBack()):e.aboutToShow?r.logInteraction(n.queueButtonFactory().hitUiReveal()):r.logInteraction(n.queueButtonFactory().hitUiHide())}}),(0,v.jsx)(We,{}),(0,v.jsx)(Ot.M,{className:zt,onVolumeBarClick:e=>{r.logInteraction(n.volumeBarFactory().hitSetVolume({newVolumePercentage:Math.floor(100*e)}))},onToggleMuteClick:e=>{"muted"===e?r.logInteraction(n.volumeMuteButtonFactory().hitMutePlayback()):"not_muted"===e&&r.logInteraction(n.volumeMuteButtonFactory().hitUnmutePlayback())},onVolumeBarDrag:o}),(0,v.jsx)(_t,{onClick:c}),(0,v.jsx)(ae,{className:"control-button",disabledClassName:"control-button--disabled",onClick:e=>{e&&r.logInteraction(n.fullscreenButtonFactory().hitUiReveal())}})]})})};var Gt=i(28007),Qt=i(7504),Ht=i(1263);const qt="yyrJTUPMeLS8qs1a0YJr",Kt=({logoUrl:e})=>e?(0,v.jsx)("div",{className:qt,"data-testid":"context-ad-logo",children:(0,v.jsx)(Qt.N,{loading:"eager",imgSrc:e,width:56,height:56,type:Ht.c.AD})}):null;var Yt=i(5888),Zt=i(11440),Wt=i(30275);const Xt=({item:e,context:t,index:i})=>{const{logoImage:a}=(0,Yt.b)(e);return(0,v.jsx)(Wt.e,{item:e,context:t,index:i,"aria-label":d.Ru.get("ad-formats.advertisement"),adEventReason:Zt.c.AD_LOGO,isVisible:!1,children:(0,v.jsx)(Kt,{logoUrl:a})})};var Jt=i(24771),$t=i(19792);const ei=a.memo((function({uri:e,className:t,onClick:i,size:n=Jt.t.xs}){const[r,s]=(0,$t.A)(e),o=(0,Nt.W)(),c=(0,a.useCallback)((t=>{t.preventDefault(),o({targetUri:e,intent:r?"remove-from-library":"add-to-library",type:"click"}),i&&i(!r),s(!r)}),[o,e,r,i,s]);return(0,v.jsx)(Jt.M,{className:t,size:n,onClick:c,isAdded:!!r,condensed:!0})}));var ti=i(49530),ii=i(76540),ai=i(52697);const ni=({uri:e,isBook:t=!1,size:i=Jt.t.xs,className:n,onClick:r})=>{const{isPreSaved:s,addPresave:o,removePresave:c}=(0,ai.w)({uri:e,isBook:t}),l=(0,a.useCallback)((()=>{s?c():o(),r?.(!s)}),[s,r,c,o]);return(0,v.jsx)(Jt.M,{className:n,size:i,onClick:l,isAdded:!!s,condensed:!0})};var ri=i(45944),si=i(56526),oi=i(59756),ci=i(45664),li=i(47290),ui=i(4881),di=i(31817),mi=i(70725),gi=i(66611),pi=i(65703),vi=i(37639),yi=i(12689);function bi(e){return(0,yi.v)(e)||(0,vi.p)(e)}const hi=ze.$S.NPV_BUTTON_CLICK,ki=()=>{const e=(0,X.l)(),t=(0,z.NC)($.mzn),i=(0,z.NC)($.wZE),n=(0,ui.S)(),r=(0,Me._Y)();return(0,a.useCallback)((()=>{t?n===W.z.CLOSED?i?e(W.z.NOW_PLAYING_VIEW):r(hi):e(W.z.CLOSED):r(hi)}),[i,n,t,r,e])};var xi=i(72382),Ci=i(55995),Ni=i(15845);const fi="main-nowPlayingWidget-nowPlaying",Ii="ZbFkATBbLkWh2SHMXDt6",ji="main-coverSlotCollapsed-navAltContainer",Ai="main-nowPlayingWidget-coverArt",Si="main-nowPlayingWidget-trackInfo",wi="HD9s7U5E1RLSWKpXmrqx",Ti=({spec:e})=>{const t=(0,Ni.s)(),i=(0,Rt.L)(),{draggable:n,onDragStart:r}=(0,Ci.P)(),s=(0,ui.S)(),{isActive:o}=(0,Me.AI)(Ve.Z.NowPlayingView),c=(0,z.NC)($.mzn),l=ki(),{images:u}=(0,xi.u)(i?.item),m=c?s===W.z.NOW_PLAYING_VIEW:o,g=(0,a.useCallback)((()=>{l();const i=m?e.hitUiHide():e.hitUiReveal();t.logInteraction(i)}),[m,t,e,l]);if(null===i)return null;const{context:p,item:y}=i;return(0,v.jsx)(li.h,{menu:(0,v.jsx)(mi.W,{context:p,item:y}),children:(0,v.jsx)("div",{draggable:n&&bi(y),onDragStart:e=>{r(e,{itemUris:[y.uri],dragLabelText:(0,pi.r)(y)})},children:(0,v.jsx)(gi.R,{uri:p.uri,owner:p.metadata?.context_owner,children:(0,v.jsx)("button",{type:"button","data-testid":"cover-art-button",className:wi,"aria-label":d.Ru.get("web-player.now-playing-view.label"),onClick:g,children:(0,v.jsx)(di.b,{images:u,type:y.type,size:56,maxSize:56,className:Ai})})})})})};var Pi=i(93465),Di=i(30952),Li=i(59567),Ei=i(56962);const Ri="main-coverSlotCollapsed-container",Bi="main-coverSlotCollapsed-expandButton",_i=ze.$S.NPV_BUTTON_CLICK,Oi=({children:e,className:t,spec:i})=>{const n=(0,Ni.s)(),s=(0,Me.Ev)(_i),o=(0,ui.S)(),{isActive:c}=(0,Me.AI)(Ve.Z.NowPlayingView),l=(0,z.NC)($.mzn),u=(0,z.NC)($.wZE),m=ki(),g=(0,a.useMemo)((()=>{if(l&&u){const e=o===W.z.NOW_PLAYING_VIEW;return{label:e?d.Ru.get("web-player.cinema-mode.minimize"):d.Ru.get("web-player.now-playing-view.cinema-mode.expand"),Icon:e?Pi.b:G.L,isActive:e,isDisabled:!1}}return{label:c?d.Ru.get("npb.collapseCoverArt"):d.Ru.get("npb.expandCoverArt"),Icon:c?Di.r:Li.o,isActive:c,isDisabled:!s}}),[u,s,o,l,c]),p=(0,a.useCallback)((()=>{m();const e=i.coverartArrowFactory(),t=g.isActive?e.hitUiHide():e.hitUiReveal();n.logInteraction(t)}),[n,i,g.isActive,m]);return(0,v.jsxs)("div",{"data-testid":"CoverSlotCollapsed__container",className:r()(Ri,t),children:[e,(0,v.jsx)(Ei.Zp,{label:g.label,children:(0,v.jsx)("button",{className:r()(Bi),disabled:g.isDisabled,onClick:p,"aria-label":g.label,"aria-pressed":g.isActive,children:(0,v.jsx)(g.Icon,{iconSize:16})})})]})};var Ui=i(41205),Fi=i(38439),Mi=i(4136);var zi=i(87287),Vi=i(87565),Gi=i(49873),Qi=i(63365),Hi=i(55),qi=i(4945),Ki=i(16859),Yi=i(43943);const Zi=({context:e,item:t,onLike:i})=>{const a=(0,Gi.X)(),n=(0,si.v)(t);if(a&&(0,Vi.N)(t))return(0,v.jsx)(zi.o,{contextUri:t.metadata?.context_uri??e.uri,id:t.uid??void 0,uri:t.uri,isActive:!0});if(n)return(0,v.jsx)(ri.g,{uri:t.uri,condensed:!0});if((0,yi.v)(t))return t.isLocal?null:(0,v.jsx)(ii.b,{uri:t.uri,className:"control-button control-button-heart",onClick:i});if((0,vi.p)(t))return(0,v.jsx)(ti.b,{condensed:!0,uri:t.uri,className:"control-button control-button-heart",onClick:i});if((0,Hi.d)(t)){return"trailer"===t?.metadata?.type&&"true"===t?.metadata?.is_pre_release?(0,v.jsx)(ni,{uri:t.book.uri,isBook:!0,className:"control-button control-button-heart",onClick:i}):(0,v.jsx)(ei,{uri:t.book.uri,className:"control-button control-button-heart",onClick:i})}return(0,Qi.N)(t)||(0,qi.v)(t)?null:(0,Yi.d)(t)},Wi=({state:{item:e,context:t,index:i}})=>{!function(e){const t=(0,Mi.i)(),i=(0,Fi.X)(e);(0,a.useEffect)((()=>{i&&t.say(i)}),[i,t])}(e);const{videoPlayerMode:n,setVideoPlayerUIFlag:r}=(0,jt.d)(),{spec:s,logger:o}=(0,I.r)(Gt.p6,{data:{identifier:n===At.Kz.cinemaLegacy?Gt.gw.CINEMA:Gt.gw.DESKTOP}}),c=(0,Fi.P)(e),l=(0,z.NC)($.WAA);(0,a.useEffect)((()=>{r(At.nP.nowPlayingBar,l)}),[l,r]);const u=n===At.Kz.nowPlayingBar&&l,d=(0,a.useMemo)((()=>s.coverartFactory({uri:e.uri})),[e.uri,s]);return(0,v.jsx)(a.Suspense,{fallback:null,children:(0,v.jsx)("div",{"data-testid":"now-playing-widget",className:fi,role:"contentinfo","aria-label":c,children:(0,v.jsxs)(Ki.r,{spec:s,children:[(0,Qi.N)(e)?(0,v.jsx)(Xt,{item:e,context:t,index:i}):(0,v.jsxs)(Oi,{className:ji,spec:d,children:[!u&&(0,v.jsx)(Ti,{spec:d}),l&&(0,v.jsx)("div",{id:"VideoPlayerNpb_ReactPortal"})]}),(0,v.jsx)(oi.d,{context:t,className:Si,item:e,size:"xsmall",enableVideoButton:!0,onTitleClick:t=>{o.logInteraction(s.titleFactory({uri:e.uri}).hitUiNavigate({destination:t||""}))},onSubtitleClick:t=>{o.logInteraction(s.subtitleFactory({uri:e.uri}).hitUiNavigate({destination:t||""}))},referrer:ci.G.NPB}),(0,v.jsxs)("div",{className:Ii,children:[(0,v.jsx)(Ui.a,{context:t,item:e,onClick:()=>{o.logInteraction(s.hideButtonFactory().hitRemoveRecommendation({recommendedItemUri:e.uri,contextUri:t.uri}))}}),(0,v.jsx)(Zi,{item:e,onLike:t=>{o.logInteraction(t?s.likeButtonFactory({uri:e.uri}).hitLike({itemToBeLiked:e.uri}):s.likeButtonFactory({uri:e.uri}).hitRemoveLike({itemNoLongerLiked:e.uri}))},context:t})]})]})})})},Xi=()=>{const e=(0,Rt.L)();return null===e?(0,v.jsx)("div",{className:r()("now-playing")}):(0,v.jsx)(Wi,{state:e})};var Ji=i(22682);const $i="aguQsGoZR9wZeawKGdDh",ea="ieqOSqJb6kk3bG5XDOHk",ta=({paused:e,fromSeconds:t})=>{const[i,n]=(0,a.useState)(t);return(0,Ji.$)((t=>{n((i=>e?i:i>0?i-1:(t(),i)))}),1e3),(0,v.jsxs)("div",{className:$i,children:[d.Ru.get("ad-formats.skippable_ads.skip_countdown"),(0,v.jsx)("span",{className:ea,children:i})]})};var ia=i(98207);const aa=({children:e})=>{const t=(0,te.o)((e=>e),((e,t)=>(0,R.a)(e?.restrictions,t?.restrictions)&&e?.item?.uri===t?.item?.uri&&e?.isPaused===t?.isPaused)),i=t?.restrictions.disallowSkippingNextReasons.includes("ad_disallow"),a=t?.isPaused??!1,n=(0,ia.qc)(t),r=(0,ia.Tv)(t),o=(0,s.d4)((e=>n?e?.ads?.audio?.info?.skippableAdDelaySeconds:r?e?.ads?.vto?.info?.skippableAdDelaySeconds:void 0));return i&&o?(0,v.jsx)(ta,{paused:!!a,fromSeconds:o}):(0,v.jsx)(v.Fragment,{children:e})};var na=i(68018),ra=i(29012);var sa=i(81421),oa=i(45127);const ca=e=>{const[t,i]=(0,a.useState)(new Map),[n,r]=(0,a.useState)(),s=(0,sa.L)(),o=(0,ra.mr)(),{currentDevice:c}=(0,Oe.l)(),l=(0,oa.vh)(),u=(0,a.useCallback)((()=>{if(!e)return;const a=(({lastRecordedItem:e,setLastRecordedItem:t,recentAds:i,setRecentAds:a,playerStateItem:n,currentDevice:r})=>{let s={isMissingAdData:!1};if(n&&n.uri!==e?.uri){if(e?.type===Ht.c.AD){const t=e?.uri.split(":")[2];i.has(t)?a((e=>{const i=new Map(e);return i.delete(t),i})):s={isMissingAdData:!0,errorMessage:r.isLocal?"primary_device":"secondary_device",adId:t}}t((()=>n))}return s})({lastRecordedItem:n,setLastRecordedItem:r,recentAds:t,setRecentAds:i,playerStateItem:s?.item,currentDevice:c});if(a.isMissingAdData){const{errorMessage:e,adId:t}=a;l.send((0,na.G)({error_type:"missing_ad_data",error_message:e,slot:"stream",ad_id:t}))}}),[s,n,t,l,c,e]),d=(0,a.useCallback)((()=>{e&&o&&i((e=>{let i=e;return t.has(o.adId)||(i=new Map(e).set(o.adId,o)),i}))}),[t,o,e]);(0,a.useEffect)((()=>{u()}),[u]),(0,a.useEffect)((()=>{d()}),[d])};var la=i(26220),ua=i(8308),da=i(9999),ma=i(78875),ga=i(59327),pa=i(24897),va=i(69515),ya=i(8555),ba=i(62727),ha=i(94040);const ka="player-controls",xa="player-controls__buttons",Ca="player-controls__left",Na="player-controls__right",fa=(0,a.memo)((function({item:e}){const t=ma.Q.isPodcastAd(e),i=ma.Q.isSurveyAd(e);return(0,v.jsxs)("div",{"data-testid":"ad-controls",className:xa,children:[(0,v.jsxs)("div",{className:Ca,children:[t&&(0,v.jsx)(ha.w,{}),(0,v.jsx)(da.T,{item:e,isDisabled:i}),t?(0,v.jsx)(pa.h,{}):(0,v.jsx)(ya.d,{})]}),(0,v.jsx)(ga.x,{}),(0,v.jsxs)("div",{className:Na,children:[t?(0,v.jsx)(va.v,{}):(0,v.jsx)(aa,{children:(0,v.jsx)(ba.$,{})}),(0,v.jsx)(ua.t,{item:e,isDisabled:i})]})]})}));var Ia=i(68311),ja=i(58645),Aa=i(45105),Sa=i(90744),wa=i(25945),Ta=i(16440);var Pa=i(73604),Da=i(38514),La=i(78638);const Ea="JbGNL7qsnWz6EP_3hGvf",Ra="mkROcxw9LM6F2uuwQYjN",Ba=e=>{const{className:t,...i}=e;return(0,v.jsx)("span",{className:Ra,children:(0,v.jsx)(La.x,{className:r()(t),...i})})};var _a=i(84206),Oa=i(23310),Ua=i(62316),Fa=i(28861),Ma=i(14073),za=i(9466),Va=i(60902);const Ga=function({setSleepTimer:e,state:t}){const i=t.type===Ma.k.Off?Fa.X:Fa.X.concat(Ma.k.Off);return(0,v.jsxs)(_a.W,{children:[(0,v.jsx)(Oa.y,{children:d.Ru.get("web-player.sleep-timer.player-controls.popover.title")}),(0,v.jsx)("div",{children:i.map((i=>(0,v.jsx)(Ua.D,{onClick:()=>{e(i)},"data-testid":`playback-sleep-timer-option-${i}`,role:"menuitemradio","aria-label":`${i}`,"aria-checked":t.type===i,children:t.type===i?(0,Va.J)(i,t.endsAt,Ht.c.EPISODE):(0,za.p)(i,Ht.c.EPISODE)},i)))})]})};var Qa=i(74891);const Ha=e=>e-Date.now(),qa=({endsAt:e})=>{const[t,i]=(0,a.useState)(Ha(e));return(0,a.useEffect)((()=>{i(Ha(e));const t=setInterval((()=>{i(Ha(e))}),1e3);return()=>{clearInterval(t)}}),[e]),(0,v.jsx)(l.E,{variant:"marginal",semanticColor:"textBrightAccent",children:(0,Qa.f)(t)})};var Ka=i(2388);const Ya=({onClick:e})=>{const t=(0,z.NC)($.GhO),[i,a]=(0,Ka.y)(),n=i.type!==Ma.k.Off,{endsAt:r}=i;return t?(0,v.jsx)(Da.t,{placement:"top-start",menu:(0,v.jsx)(Ga,{state:i,setSleepTimer:t=>{a(t),e?.(t)}}),children:(e,t,i)=>(0,v.jsx)(Ei.Zp,{label:d.Ru.get("web-player.sleep-timer.player-controls.button.tooltip"),children:(0,v.jsx)(ce.H,{ref:i,className:Ea,iconLeading:n?Ba:Pa.l,size:"small",onClick:t,role:"checkbox","aria-label":d.Ru.get("web-player.sleep-timer.player-controls.button.tooltip"),"data-testid":"control-button-sleep-timer","aria-checked":n,semanticColor:n?"textBrightAccent":void 0,children:n&&r&&(0,v.jsx)(qa,{endsAt:r})})})}):null};var Za=i(26691),Wa=i(25234);const Xa=(0,a.memo)((function({isPreview:e}){const{logChangePlaybackSpeed:t,logChangeRepeatMode:i,logChangeShuffleMode:n,logSeekForward:r,logSeekBack:s,logSkipForward:o,logSkipBack:c,logPlayPause:l,logProgressChanged:u,spec:m}=(()=>{const e=(0,Ce.z)(),{videoPlayerMode:t}=(0,jt.d)(),{spec:i,logger:n}=(0,I.r)(Sa.kD,{data:{identifier:t===At.Kz.cinemaLegacy?Sa.gw.CINEMA:Sa.gw.DESKTOP}});return{logChangePlaybackSpeed:(0,a.useCallback)((t=>{const a=e.getState();a?.item&&n.logInteraction(i.speedControlButtonFactory().hitSetPlaybackSpeed({currentlyPlayedItem:a.item.uri,playbackSpeed:t}))}),[n,e,i]),logChangeShuffleMode:(0,a.useCallback)((e=>{n.logInteraction(e?i.shuffleButtonFactory().hitShuffleEnable():i.shuffleButtonFactory().hitShuffleDisable())}),[n,i]),logChangeRepeatMode:(0,a.useCallback)((e=>{const t={[wa.p.REPEAT_NONE]:i.repeatButtonFactory().hitRepeatDisable(),[wa.p.REPEAT_TRACK]:i.repeatButtonFactory().hitRepeatOneEnable(),[wa.p.REPEAT_CONTEXT]:i.repeatButtonFactory().hitRepeatEnable()};n.logInteraction(t[e])}),[n,i]),logSeekBack:(0,a.useCallback)((e=>{n.logInteraction(i.seekBackButtonFactory().hitSeekByTime({msSeekedOffset:e}))}),[n,i]),logSeekForward:(0,a.useCallback)((e=>{n.logInteraction(i.seekForwardButtonFactory().hitSeekByTime({msSeekedOffset:e}))}),[n,i]),logSkipBack:(0,a.useCallback)((()=>{const t=e.getState();t&&n.logInteraction(i.previousButtonFactory().hitSkipToPrevious({itemToBeSkipped:t.item?.uri||"",positionMs:(0,Ta.s)(t)??-1,totalContentMs:t.duration??-1}))}),[n,e,i]),logSkipForward:(0,a.useCallback)((()=>{const t=e.getState();t?.item&&n.logInteraction(i.nextButtonFactory().hitSkipToNext({itemToBeSkipped:t.item.uri,positionMs:(0,Ta.s)(t)??-1,totalContentMs:t.duration??-1}))}),[n,e,i]),logPlayPause:(0,a.useCallback)((t=>{const a=e.getState();a?.item&&("resume"===t?n.logInteraction(i?.playPauseButtonFactory().hitResume({itemToBeResumed:a.item.uri})):"pause"===t&&n.logInteraction(i?.playPauseButtonFactory().hitPause({itemToBePaused:a.item.uri})))}),[n,e,i]),logProgressChanged:(0,a.useCallback)(((e,t)=>{switch(t){case"drag":return n.logInteraction(i.progressBarFactory().dragSeekToTime({msToSeekTo:e}));case"hit":return n.logInteraction(i.progressBarFactory().hitSeekToTime({msToSeekTo:e}));default:return(0,Yi.k)(t)}}),[n,i]),spec:i}})();ca((0,z.NC)($.KYh));const g=(0,te.o)((e=>e?.item??void 0),((e,t)=>e?.uri===t?.uri)),p=(0,Aa.p)();return(0,v.jsx)("div",{className:ka,"data-testid":"player-controls",dir:"ltr","aria-label":d.Ru.get("playback-control.a11y.landmark-label"),children:(0,v.jsxs)(Ki.r,{spec:m,children:[(0,Qi.N)(g)?(0,v.jsx)(fa,{item:g}):(0,v.jsxs)("div",{className:xa,"data-testid":"general-controls",children:[(0,v.jsxs)("div",{className:Ca,children:[p?(0,v.jsx)(ha.w,{onClick:t}):(0,v.jsx)(Wa.w,{renderEnabled:()=>(0,v.jsx)(Za.a,{size:"small"}),renderDisabled:()=>(0,v.jsx)(ja.u,{onClick:n})}),p&&(0,v.jsx)(pa.h,{onClick:s}),(0,v.jsx)(ya.d,{onClick:c})]}),(0,v.jsx)(ga.x,{onClick:l}),(0,v.jsxs)("div",{className:Na,children:[(0,v.jsx)(aa,{children:(0,v.jsx)(ba.$,{onClick:o})}),p?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(va.v,{onClick:r}),(0,v.jsx)(Ya,{})]}):(0,v.jsx)(Ia.s,{onClick:i})]})]}),(0,v.jsx)(la.x,{isPreview:e,onChange:u})]})})}));var Ja=i(72308),$a=i(743),en=i(25219),tn=i(35827);const an="main-nowPlayingBar-container",nn="main-nowPlayingBar-nowPlayingBar",rn="MWD1i_CSJ5N9wRBDpZmX",sn="k3NVrHXkbfflNdAxpT1_",on="m8UPWsNtWbdkvBNvqgBN",cn="aepuRyT82biv_XmkH1eS",ln="main-nowPlayingBar-left",un="main-nowPlayingBar-center",dn="main-nowPlayingBar-right",mn="K7b2iysmIbvKo8RqRbc5",gn="adzMqeRxU0__wQcuju5q",pn=(0,a.memo)((()=>{const{isAnonymous:e}=(0,s.d4)(Ze.Ht),t=(0,s.wA)(),i=(0,te.o)((e=>e),((e,t)=>e?.hasContext===t?.hasContext&&e?.item?.uri===t?.item?.uri)),n=(0,b.h)(),l=(0,te.o)((e=>(0,Qi.N)(e?.item??void 0))),u=(0,a.useCallback)((e=>{e.stopPropagation(),t((0,c.Ai)())}),[t]),d=()=>(0,v.jsx)($a.ql.Provider,{value:"now_playing_bar",children:(0,v.jsxs)("div",{className:e?rn:nn,children:[(0,v.jsx)("div",{className:ln,children:(0,v.jsx)(Xi,{})}),(0,v.jsx)("div",{className:un,children:(0,v.jsx)(a.Suspense,{fallback:null,children:(0,v.jsx)(Xa,{isPreview:e})})}),(0,v.jsx)("div",{className:dn,children:(0,v.jsx)(Vt,{})})]})});return(0,v.jsx)(tn.P,{surface:en.u.NOW_PLAYING,children:(0,v.jsx)(Ja.pZ,{value:"now-playing-bar",children:(0,v.jsxs)("footer",{className:r()(an,mn,{[gn]:n}),"data-testid":"now-playing-bar","data-testadtype":"ad-type-"+(l?"ad":"none"),children:[e?(0,v.jsx)(Ja.pZ,{value:"preview-bar",children:(0,v.jsx)(y,{handleClick:u})}):null,e?(0,v.jsx)(o.A,{in:i?.hasContext??!1,timeout:200,classNames:{enter:sn,enterActive:on,enterDone:cn},children:d()}):d(),(0,v.jsx)(F,{})]})})})}))},81353:(e,t,i)=>{i.d(t,{D:()=>u});var a=i(30758),n=i(2597);var r=i(21709),s=i(87761),o=i(92915),c=i(41666),l=i(3161);const u=({item:e,onClick:t})=>{const i=(0,o.W)(),{capabilities:{isEnabled:u},isOpen:d,close:m,open:g,canOpen:p}=(0,c.H)(),{videoPlayerMode:v}=(0,r.d)(),{spec:y,logger:b}=(0,l.r)(n.h9,{data:{identifier:v===s.Kz.cinemaLegacy?n.gw.CINEMA:n.gw.DESKTOP}}),h=(0,a.useCallback)((()=>{let a;u&&(d?(m(),e?.uri&&b.logInteraction(y.pipButtonFactory({uri:e.uri}).hitUiHide()),a="close-picture-in-picture"):(g(),e?.uri&&(({spec:e,logger:t,uri:i})=>{const a=window.documentPictureInPicture;if(!a)return;const n=r=>{setTimeout((()=>{const a=r.window?.innerWidth,n=r.window?.innerHeight;if(!a||!n)return;const s=e.pipButtonFactory({uri:i}).hitUiOpenWindow({widthPx:a,heightPx:n});t.logInteraction(s)}),100),a.removeEventListener("enter",n)};a.addEventListener("enter",n)})({spec:y,logger:b,uri:e.uri}),a="show-picture-in-picture"),t?.(!d,e?.uri),i({type:"click",intent:a,targetUri:e?.uri,itemIdSuffix:"picture-in-picture-toggle"}))}),[m,u,d,e?.uri,b,t,i,g,y]);return{showButton:p,isActive:d,onClick:h}}},85281:(e,t,i)=>{i.d(t,{T:()=>a.T});var a=i(49724)}}]);
//# sourceMappingURL=dwp-now-playing-bar.js.map